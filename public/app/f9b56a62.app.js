"use strict";angular.module("lysasoft",["ngCookies","ngResource","ngSanitize","ngRoute","ui.bootstrap","lysasoftComponents","lysasoftApi","lysasoftMain","lysasoftIndicators","lysasoftAlerts","lysasoftCashflow","lysasoftSetup","lysasoftLogin"]).config(["$routeProvider","$locationProvider","$httpProvider",function(a,b,c){a.otherwise({redirectTo:"/"}),b.html5Mode(!0),c.interceptors.push(["$q","$location",function(a,b){return{responseError:function(c){return 403===c.status&&c.data&&c.data.redirect&&b.url("/"),a.reject(c)}}}])}]).run(["$rootScope","$location","User",function(a,b,c){a.doLogout=function(){a.loggedUser=null,c.logout().$promise.then(function(){b.url("/")})}}]),angular.module("lysasoftAlerts",["ngRoute","ui.bootstrap","ui.select","lysasoftComponents","lysasoftApi"]).config(["$routeProvider",function(a){a.when("/alerts",{templateUrl:"app/alerts/alerts.html",controller:"AlertsController",controllerAs:"vm"})}]),angular.module("lysasoftApi",["ngResource"]),angular.module("lysasoftCashflow",[]).config(["$routeProvider",function(a){a.when("/cashflow",{templateUrl:"app/cashflow/cashflow.html",controller:"CashflowController",controllerAs:"vm"})}]),angular.module("lysasoftConfig",["lysasoftApi"]).run(["reloadConfig",function(a){a()}]),angular.module("lysasoftIndicators",["ngRoute","ngFileUpload","ui.bootstrap","lysasoftComponents","lysasoftConfig","lysasoftApi"]).config(["$routeProvider",function(a){a.when("/indicators",{templateUrl:"app/indicators/indicators.html",controller:"IndicatorsController",controllerAs:"vm"})}]),angular.module("lysasoftLogin",["ngRoute","ui.bootstrap","lysasoftComponents","lysasoftApi","lysasoftConfig"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"app/login/login.html",controller:"LoginController",controllerAs:"vm"})}]),angular.module("lysasoftMain",["lysasoftIndicators","lysasoftConfig"]).config(["$routeProvider",function(a){a.when("/main",{templateUrl:"app/main/main.html",controller:"MainController",controllerAs:"vm"})}]),angular.module("lysasoftSetup",["ui.checkbox","ngFileUpload"]),angular.module("lysasoftComponents",["ui.bootstrap","ngFileUpload","angular-toArrayFilter"]),angular.module("lysasoftAlerts").factory("alertEdit",["Modal","Alert",function(a,b){return function(c,d){var e={templateUrl:"app/alerts/alert-edit.html",controller:"AlertEditController",controllerAs:"vm",resolve:{collection:function(){return c},alert:function(){return d||new b},isNew:function(){return!d}}},f=a.open(e);return f.result}}]).controller("AlertEditController",["$rootScope","$scope","$uibModalInstance","$q","Modal","AlertEmail","Server","User","isNew","alert","collection",function(a,b,c,d,e,f,g,h,i,j,k){var l=this;l.alert=j,l.servers=g.query(),l.users=h.query(),i?(l.title="Nouvelle alerte",l.alert.title="",l.alert.alertType=1,l.alert.sendDateType=1,l.alert.sendMonthDay=1,l.alert.sendWeekDay=1,l.alert.sendWeekDayNumber=1,l.alert.sendFixedDate=new Date,l.alert.eventDateType=1,l.alert.eventMonthDay=1,l.alert.eventWeekDay=1,l.alert.eventWeekDayNumber=1,l.alert.eventFixedDate=new Date,l.alert.period=-1,l.alert.idServer=a.config.currentServerId,l.alert.set_servers=[],l.alertEmails=[]):(l.title="Éditer l’alerte",l.alert.sendFixedDate=new Date(l.alert.sendFixedDate),l.alert.eventFixedDate=new Date(l.alert.eventFixedDate),l.alertEmails=f.query({idAlert:l.alert.idAlert}),l.alert.set_servers=_.map(l.alert.servers,"idServer"),l.disabled=!a.config.isMultiServer()&&l.alert.idServer!==a.config.currentServerId),!l.alert.set_servers.length&&l.alert.idServer&&l.alert.set_servers.push(l.alert.idServer),l.save=function(){1===l.alert.set_servers.length&&(l.alert.idServer=l.alert.set_servers[0],l.alert.set_servers=[]),l.alert.set_servers.length>1&&(l.alert.idServer=null),l.alert.$save().then(function(){l.alert.sendFixedDate=new Date(l.alert.sendFixedDate),l.alert.eventFixedDate=new Date(l.alert.eventFixedDate);var a=_.map(l.alertEmails,function(a){return a.idAlert=l.alert.idAlert,a.$save()}).concat(_.map(l.emailsToDelete,function(a){return a.$delete()}));return d.all(a).then(function(){return i&&k.push(j),l.alert.emails=l.alertEmails,b.$close(l.alert)})})},l.cancel=function(){b.$dismiss()},l.newEmail=function(){l.alertEmails.push(new f)},l.userUpdated=function(a){var b=_.find(l.users,{uuid:a.idUser});b&&(a.email=b.email)},l.deleteEmail=e.confirm["delete"](function(a){var b=l.alertEmails.splice(a,1)[0];b.idAlertEmail&&l.emailsToDelete.push(b)}),l.emailsToDelete=[]}]),angular.module("lysasoftAlerts").controller("AlertsController",["$scope","$q","Alert","Server","Modal","alertEdit","appConfig",function(a,b,c,d,e,f,g){var h=this;h.alerts=c.query(),h.newAlert=function(){f(h.alerts,null)},h.editAlert=function(a){g.user.permissions["ind.alert.update"]&&f(h.alerts,a)},h.deleteAlert=e.confirm["delete"](function(){h.currentAlert.$delete(),h.alerts.splice(h.alerts.indexOf(h.currentAlert),1)}),h.selectAlert=function(a){h.currentAlert=h.currentAlert===a?null:a},h.servers=d.query(),h.thisServer=d.me()}]),angular.module("lysasoftApi").factory("Alert",["$resource",function(a){function b(a,b,c,d,e){if("number"!=typeof d||Number.isNaN(d))return"";var f,g=moment().isoWeekday(d).format("dddd");switch(c){case 1:f="premier";break;case 2:f="deuxième";break;case 3:f="troisième";break;case 4:f="quatrième";break;case-1:f="dernier";break;default:f=c}switch(a){case 1:return"Le "+b+" de chaque mois";case 2:return"Le "+f+" "+g+" du mois";case 3:return"Le "+moment(e).format("dddd D MMMM YYYY")}}var c=a("/api/ind/alert/:id",{id:"@idAlert"},{});return c.prototype.typeDescription=function(){var a;switch(this.period){case 0:a="courante";break;case-1:a="précédente";break;default:a="n"+(this.period>=0?"+":"")+this.period}switch(this.alertType){case 1:return"Un évènement ou une action planifiés arrivent à échéance";case 2:return"Des indicateurs de la période "+a+" ne sont pas renseignés";case 3:return"Des indicateurs de la période "+a+" dépassent les seuils"}},c.prototype.sendDescription=function(){return b(this.sendDateType,this.sendMonthDay,this.sendWeekDayNumber,this.sendWeekDay,this.sendFixedDate)},c.prototype.eventDescription=function(){return b(this.eventDateType,this.eventMonthDay,this.eventWeekDayNumber,this.eventWeekDay,this.eventFixedDate)},c}]),angular.module("lysasoftApi").factory("AlertEmail",["$resource",function(a){return a("/api/ind/alert/:idAlert/email/:id",{idAlert:"@idAlert",id:"@idAlertEmail"})}]),angular.module("lysasoftApi").factory("AllBillingPeriods",["$resource",function(a){return a("/api/tour/all_billing_periods/:billingPeriod",{billingPeriod:"@billingPeriod"},{query:{method:"GET",isArray:!0},get:{method:"GET"},last:{method:"GET",url:"/api/tour/all_billing_periods/last"}})}]),angular.module("lysasoftApi").factory("Backup",["$resource",function(a){return a("/api/bkp/backup/:id",{id:"@idBackup"},{})}]),angular.module("lysasoftApi").factory("BackupType",["$resource",function(a){return a("/api/bkp/backup_type/:id",{id:"@idBackupType"},{})}]),angular.module("lysasoftApi").factory("Domain",["$resource",function(a){return a("/api/prm/domain/:id",{id:"@idDomain"},{})}]),angular.module("lysasoftApi").factory("Group",["$resource",function(a){return a("/api/prm/group/:id",{id:"@idGroup"},{})}]),angular.module("lysasoftApi").factory("Indicator",["$resource",function(a){var b=a("/api/ind/indicator/:id",{id:"@idIndicator"},{get:{method:"GET"},save:{method:"POST"},query:{method:"GET",isArray:!0},remove:{method:"DELETE"},"delete":{method:"DELETE"},move:{method:"POST",url:"/api/ind/indicator/move"}});return b.exportUrl="/api/ind/indicator/export.xlsx",b}]),angular.module("lysasoftApi").factory("IndicatorAttachment",["$resource",function(a){var b=a("/api/ind/indicator/:idIndicator/period/:billingPeriod/attachment/:id",{idIndicator:"@idIndicator",billingPeriod:"@billingPeriod",id:"@idAttachment"});return b.prototype.url=function(){return"/api/file/File/"+this.idFile},b}]),angular.module("lysasoftApi").factory("IndicatorObjective",["$resource",function(a){return a("/api/ind/indicator/:idIndicator/objective/:id",{idIndicator:"@idIndicator",id:"@idIndicatorObjective"})}]),angular.module("lysasoftApi").factory("IndicatorType",["$resource",function(a){return a("/api/stat/indicator_type/:id",{id:"@idIndicatorType"},{get:{method:"GET"},query:{method:"GET",isArray:!0},value:{method:"GET",url:"/api/stat/indicator_type/:id/value/:date"}})}]),angular.module("lysasoftApi").factory("IndicatorUser",["$resource",function(a){return a("/api/ind/indicator/:idIndicator/user/:id",{idIndicator:"@idIndicator",id:"@idIndicatorUser"})}]),angular.module("lysasoftApi").factory("IndicatorValue",["$resource",function(a){return a("/api/ind/indicator/:idIndicator/period/:billingPeriod/value/:id",{id:"@idIndicatorValue",idIndicator:"@idIndicator",billingPeriod:"@billingPeriod"})}]),angular.module("lysasoftApi").factory("Period",["$resource",function(a){return a("/api/cf/period/:id",{id:"@idPeriod"},{get:{method:"GET"},query:{method:"GET",isArray:!0},close:{method:"POST",url:"/api/cf/period/:id/close"},reopen:{method:"POST",url:"/api/cf/period/:id/reopen"}})}]),angular.module("lysasoftApi").factory("Permission",["$resource",function(a){return a("/api/prm/permission/:id",{id:"@idPermission"},{})}]),angular.module("lysasoftApi").factory("predictionParser",function(){return function(a,b){function c(a){return a.predictedDate=a.predictedDate&&new Date(a.predictedDate),a.realDate=a.realDate&&new Date(a.realDate),a}var d=angular.fromJson(a);return d=_.isArray(d)?_.map(d,c):c(d)}}).factory("Prediction",["$resource","predictionParser",function(a,b){return a("/api/cf/period/:idPeriod/predictions/:id",{id:"@idPrediction",idPeriod:"@idPeriod"},{get:{method:"GET",transformResponse:b},save:{method:"POST",transformResponse:b},query:{method:"GET",isArray:!0,transformResponse:b},remove:{method:"DELETE",transformResponse:b},"delete":{method:"DELETE",transformResponse:b}},{})}]),angular.module("lysasoftApi").factory("RecurringPrediction",["$resource","predictionParser",function(a,b){return a("/api/cf/period/:idPeriod/recurring_predictions",{id:"@idPrediction",idPeriod:"@idPeriod"},{get:{method:"GET",transformResponse:b},query:{method:"GET",isArray:!0,transformResponse:b}},{})}]),angular.module("lysasoftApi").factory("SentAlert",["$resource",function(a){var b=a("/api/ind/sent_alert/:id",{id:"@idSentAlert"},{viewed:{method:"POST",url:"/api/ind/sent_alert/viewed"},get:{method:"GET"},query:{method:"GET",isArray:!0}});return b.prototype.isToday=function(){var a=moment();return a.isSame(this.expiresDate,"d")},b}]),angular.module("lysasoftApi").factory("SentAlertEmail",["$resource",function(a){return a("/api/ind/sent_alert/:idAlert/email/:id",{idSentAlert:"@idSentAlert",id:"@idSentAlertEmail"})}]),angular.module("lysasoftApi").factory("Server",["$resource",function(a){var b=a("/api/prm/server/:id",{id:"@idServer"},{me:{method:"GET",url:"/api/prm/server/me"},get:{method:"GET"},save:{method:"POST"},query:{method:"GET",isArray:!0},remove:{method:"DELETE"},"delete":{method:"DELETE"}});return b.prototype.logoUrl=function(){return this.idFile&&"/api/file/File/"+this.idFile},b}]),angular.module("lysasoftApi").factory("SyncConfig",["$resource",function(a){return a("/api/sync/config",{},{})}]),angular.module("lysasoftApi").factory("Synchronization",["$resource",function(a){return a("/api/sync/synchronization/:id",{id:"@idSynchronization"},{get:{method:"GET"},test:{method:"POST",url:"/api/sync/synchronization/:id/test"},save:{method:"POST"},query:{method:"GET",isArray:!0},remove:{method:"DELETE"},"delete":{method:"DELETE"}})}]),angular.module("lysasoftApi").factory("User",["$resource","predictionParser",function(a,b){return a("/api/prm/user/:idUser",{idUser:"@idUser"},{get:{method:"GET"},query:{method:"GET",isArray:!0},logged:{method:"GET",url:"/api/prm/user/logged"},login:{method:"POST",url:"/api/login"},logout:{method:"POST",url:"/api/logout"}},{})}]),angular.module("lysasoftCashflow").controller("CashflowController",["$scope","$http","$uibModal","Modal","Period","Prediction","RecurringPrediction","periodClose","editPredictionRecurrence",function(a,b,c,d,e,f,g,h,i){function j(a){if(!(a instanceof f)){var b=_.defaults(a,{idPeriod:l.currentPeriod.idPeriod});a=new f(b)}return a.$save()}function k(){l.allPredictions=(l.predictions||[]).concat(l.recurringPredictions||[])}var l=this;l.addPrediction=function(){var a=new f({idPeriod:l.currentPeriod.idPeriod});l.predictions.push(a),a.$save()},l.deletePrediction=d.confirm["delete"](function(){l.currentPrediction.$delete(),_.remove(l.predictions,function(a){return a===l.currentPrediction}),l.currentPrediction=null}),l.delayPrediction=function(){var a=new f({idPeriod:l.currentPeriod.idPeriod,predictedAmount:l.currentPrediction.predictedAmount,predictedDate:l.currentPrediction.predictedDate});j(a).then(function(){l.currentPrediction.idDelayedTo=a.idPrediction,a.delayedFrom=angular.copy(l.currentPrediction),l.currentPrediction.delayedTo=a,l.predictions.push(a),j(l.currentPrediction)})},l.cancelPrediction=function(){l.currentPrediction.canceled=!0,j(l.currentPrediction)},l.restorePrediction=function(){l.currentPrediction.canceled=!1,j(l.currentPrediction)},l.closePeriod=function(){h({predictions:l.predictions,currentPeriod:l.currentPeriod},function(){l.reset()})},l.editPredictionRecurrence=function(){i({prediction:l.currentPrediction},function(){})},l.reopenPeriod=d.confirm.ask({title:"Ré-ouvrir la période",html:"<p>Êtes-vous sûr de vouloir ré-ouvrir cette période?</p>"},function(){e.reopen({idPeriod:l.currentPeriod.idPeriod}).$promise.then(function(a){l.reset()})["catch"](function(a){})}),l.exportData=function(){},l.changed=function(a){j(a)},l.selectRow=function(a){l.currentPrediction=a},l.reset=function(){l.currentPeriod=l.isLastPeriod=l.isLastClosedPeriod=l.currentPrediction=null,l.periods=e.query(),l.periods.$promise.then(function(){l.currentPeriod=l.periods.length&&l.periods[l.periods.length-1]})},l.reset(),a.$watch("vm.currentPeriod",function(){function a(){l.allPredictions=(l.predictions||[]).concat(l.recurringPredictions||[])}l.currentPeriod&&(l.predictions=f.query({idPeriod:l.currentPeriod.idPeriod}),l.recurringPredictions=g.query({idPeriod:l.currentPeriod.idPeriod}),l.predictions.$promise.then(a),l.recurringPredictions.$promise.then(a)),l.currentPrediction=null,l.isLastPeriod=l.periods.length>=1&&l.currentPeriod===l.periods[l.periods.length-1],l.isLastClosedPeriod=l.periods.length>=2&&l.currentPeriod===l.periods[l.periods.length-2]}),a.$watchCollection("vm.predictions",k),a.$watchCollection("vm.recurringPredictions",k),a.$watch("vm.allPredictions",function(){l.currentPeriod&&_.each(l.allPredictions,function(a){a.idDelayedTo&&(a.delayedTo=_.find(l.predictions,{idPrediction:a.idDelayedTo}));var b=angular.copy(_.find(l.predictions,{idDelayedTo:a.idPrediction}));if(b&&(b.delayedTo=b.delayedFrom=null,a.delayedFrom=b),a.predictedDate){var c=new Date(l.currentPeriod.date),d=_(l.allPredictions).filter(function(b){return null!==b.predictedDate&&b.predictedDate<=a.predictedDate&&b.predictedDate>=c&&(!b.delayedFrom||b.delayedFrom.idPeriod!==a.idPeriod)}).pluck("predictedAmount").map(function(a){return+a}).reduce(function(a,b){return a+b});a.predictedBalance=+l.currentPeriod.balance+(d||0)}else a.predictedBalance=null;a.realDate?a.realBalance=+l.currentPeriod.balance+_(l.allPredictions).filter(function(b){return!b.canceled&&!b.idDelayedTo&&null!==b.realDate&&b.realDate<=a.realDate}).pluck("realAmount").map(function(a){return+a}).reduce(function(a,b){return a+b}):a.realBalance=null})},!0)}]),angular.module("lysasoftCashflow").factory("periodClose",["Modal",function(a){return function(b,c){b=_.extend({title:"Clôturer la période"},b),a.question({templateUrl:"app/cashflow/period-close.html",controller:"PeriodCloseController"},b,c)}}]).controller("PeriodCloseController",["$scope","Period","Modal",function(a,b,c){var d=a;d.dateChanged=function(){d.unresolvedCount=_.filter(d.predictions,function(a){return(null===a.realDate||null===a.realAmount)&&a.predictedDate<=d.closingDate&&!a.canceled&&!a.idDelayedTo}).length,d.realBalance=d.summedBalance=+d.currentPeriod.balance+_(d.predictions).filter(function(a){return!a.canceled&&!a.idDelayedTo&&null!==a.realDate&&a.realDate<=d.closingDate}).pluck("realAmount").map(function(a){return+a}).reduce(function(a,b){return a+b})},d.closePeriod=function(){b.close({idPeriod:d.currentPeriod.idPeriod,date:d.closingDate,balance:+d.realBalance}).$promise.then(function(b){a.$close()})["catch"](function(a){d.error=a.data&&a.data.error})}}]),angular.module("lysasoftCashflow").factory("editPredictionRecurrence",["Modal",function(a){return function(b,c){b=_.extend({title:"Éditer la récurrence"},b),a.question({templateUrl:"app/cashflow/recurring-prediction.html",controller:"RecurringPredictionController"},b,c)}}]).controller("RecurringPredictionController",["$scope","Period","Modal",function(a,b,c){}]),angular.module("lysasoftConfig").factory("appConfig",["$rootScope",function(a){var b={state:{periodCount:6,startingPeriod:null,sidebarOpen:!0,currentServer:null},sync:null,user:null,server:null,currentServerId:null};return b.isMultiServer=function(){return b.sync&&b.sync.server&&b.user&&!b.user.isSiteUser},a.config=b,b}]),angular.module("lysasoftConfig").factory("reloadConfig",["$q","SyncConfig","Server","User","navbarMenu","appConfig",function(a,b,c,d,e,f){return function(){f.sync=b.get(),f.user=d.logged(),f.server=c.me(),f.currentServerId=null,e.length=0,e.push({title:"Accueil",link:"/main",icon:"fa-home"}),e.push({title:"Indicateurs",link:"/indicators",icon:"fa-line-chart",permission:"_.web.indicators"}),e.push({title:"Alertes",link:"/alerts",icon:"fa-bell-o",permission:"_.web.alerts"});var g={title:"Configuration",icon:"fa-wrench",permission:"_.web.config",submenu:[{title:"Utilisateurs",icon:"fa-user",link:"/setup/users",permission:"_.web.config.users"},{title:"Groupes",icon:"fa-group",link:"/setup/groups",permission:"_.web.config.groups"}]};e.push(g),a.all([f.sync.$promise,f.server.$promise,f.user.$promise]).then(function(){f.sync.server?(f.isMultiServer()||(f.currentServerId=f.user.user.idServer),g.submenu.push({title:"Domaines",icon:"fa-diamond",link:"/setup/domains",permission:"_.web.config.domains"}),g.submenu.push({title:"Serveurs",icon:"fa-server",link:"/setup/servers",permission:"_.web.config.servers"})):(f.currentServerId=f.server.idServer,g.submenu.push({title:"Synchronisation",icon:"fa-server",link:"/setup/sync",permission:"_.web.config.servers"}))})}}]),angular.module("lysasoftIndicators").directive("headerSplitter",["$window",function(a){return{restrict:"A",scope:{width:"="},link:function(b,c,d){var e=function(){b.width<10&&(b.width=10),b.width>60&&(b.width=60),c.css({left:b.width+"%"})},f=function(d){var f=angular.element(a),g=b.width,h=d.pageX,i=function(a){var d=c.parent().width();b.width=g-100*(h-a.pageX)/d,e(),b.$apply()},j=function(a){a.preventDefault(),f.unbind("mousemove",i),f.unbind("mouseup",j)};d.preventDefault(),f.bind("mousemove",i),f.bind("mouseup",j)};e(),c.on("mousedown",f)}}}]),angular.module("lysasoftIndicators").factory("indicatorEdit",["Modal","Indicator",function(a,b){return function(c,d,e){var f={templateUrl:"app/indicators/indicator-edit.html",controller:"IndicatorEditController",controllerAs:"vm",resolve:{idServer:function(){return c},collection:function(){return d},indicator:function(){return e||new b},isNew:function(){return!e}}},g=a.open(f);return g.result}}]).controller("IndicatorEditController",["$scope","$uibModalInstance","$q","Modal","IndicatorType","IndicatorObjective","User","appConfig","idServer","collection","indicator","isNew",function(a,b,c,d,e,f,g,h,i,j,k,l){var m=this;m.indicator=angular.copy(k),m.users=g.query({server:k.idServer,permission:"ind.indicator.value",active:!0}),m.indicator.set_users=(m.indicator.users||[]).map(function(a){return a.uuid}),l?(m.title="Nouvel indicateur",m.indicator.name="",m.indicator.code="",m.indicator.unit="",m.indicator.type=1,m.indicator.decimals=2,m.indicator.limitMin=0,m.indicator.limitMax=100,m.indicator.baseline=50,m.indicator.idServer=i,m.indicatorObjectives=[]):(m.title="Éditer l’indicateur",m.indicatorObjectives=f.query({idIndicator:m.indicator.idIndicator})),m.readonly=!(m.indicator.idServer===i||h.sync.server),m.save=function(){m.form.$setSubmitted(),m.form.$valid&&(angular.copy(m.indicator,k),k.$save().then(function(){var b=_.map(m.indicatorObjectives,function(a){return a.idIndicator=k.idIndicator,a.$save()}).concat(_.map(m.indicatorsToDelete,function(a){return a.$delete()}));return c.all(b).then(function(){return l&&j.push(k),k.lastValues=m.indicator.lastValues||[],k.attachments=m.indicator.attachments||[],k.objectives=m.indicatorObjectives,a.$close(k)})}))},m.cancel=function(){a.$dismiss()},m.newObjective=function(){m.indicatorObjectives.push(new f)},m.deleteObjective=d.confirm["delete"](function(a){var b=m.indicatorObjectives.splice(a,1)[0];b.idIndicatorObjective&&m.indicatorsToDelete.push(b)}),a.$watch("vm.indicator.idIndicatorType",function(){if(m.indicator){var a=_.find(m.indicatorTypes,{idIndicatorType:m.indicator.idIndicatorType}),b=_.find(m.indicatorTypes,{name:m.indicator.name});a&&(""===m.indicator.name||b)&&(m.indicator.name=a.name)}}),m.indicatorsToDelete=[],m.indicatorTypes=e.query()}]),angular.module("lysasoftIndicators").factory("IndicatorGrid",["$q","$httpParamSerializer","Indicator","AllBillingPeriods","Server","colorScale","billingPeriodConverter",function(a,b,c,d,e,f,g){function h(){}function i(a,b){return _.range(a.billingPeriod,b.billingPeriod).map(function(c){return{billingPeriod:c,computed:c!=a.billingPeriod,value:a.value+(b.value-a.value)*(c-a.billingPeriod)/(b.billingPeriod-a.billingPeriod)}})}function j(a){return a.sort(function(a,b){return a.billingPeriod-b.billingPeriod}).map(function(a,b,c){var d=c[b+1];return d?i(a,d):[a]}).reduce(function(a,b){return a.concat(b)},[])}return h.prototype.load=function(a,b){var d=this;return a||(a=g.fromNow()-b+1),e.query().$promise.then(function(e){d.servers=e;var f=c.query({startingPeriod:a,periodCount:b});return f.$promise}).then(function(c){return d.initialize(a,b,d.servers,c)})},h.prototype.initialize=function(a,d,e,f){var g=this;return g.startingPeriod=a,g.periodCount=d,g.indicators=f,g.servers=e,g.exportUrl=c.exportUrl+"?"+b({startingPeriod:a,periodCount:d}),g.grid=[],g.grid.startingPeriod=g.startingPeriod,g.grid.periodCount=g.periodCount,_.each(f,function(a){g.setRow(a)}),g.initializeGridHeaders(),g},h.prototype.initializeRow=function(a,b,c,d){var e,f=b&&b.idServer;if(b){var g=a[f]=a[f]||{server:b,periods:{}};e=g.periods}else e=a;for(var h=0;h<this.periodCount;h++){var i,j=this.startingPeriod+h;i=b?_(c).find({billingPeriod:j,idServer:b.idServer}):_(c).find({billingPeriod:j});var k=d.attachments.filter(function(a){return a.billingPeriod===j&&null!==a.idFile}).length,l=d.attachments.filter(function(a){return a.billingPeriod===j&&null!==a.message}).length;e[j]={billingPeriod:j,value:i&&i.value,sum:i&&i.graph?_.values(i.graph).map(function(a){return a.value||0}).reduce(function(a,b){return a+b},0):void 0,computed:i&&i.computed,graph:i&&i.graph,alert:i?null!==d.alertMin&&i.value<=d.alertMin||null!==d.alertMax&&i.value>=d.alertMax:!1,noteCount:l,attachmentCount:k,manual:i&&i.manual,width:1/this.periodCount}}},h.prototype.initializeMultipleRows=function(a,b,c,d){var e=this;if(null===b)_(this.servers).each(function(b,g){e.initializeRow(a,b,c,d),a[b.idServer].color=f[g%f.length]});else{var g=_.find(this.servers,{idServer:b});this.initializeRow(a,g,c,d),a[g.idServer].color=f[0]}return a},h.prototype.findRow=function(a){return _.find(this.grid,function(b){return b.indicator===a||b.indicator.idIndicator===a.idIndicator})||(this.grid[this.grid.length]={})},h.prototype.setRow=function(a){var b=this.findRow(a);b.lastValues={},b.objectives={},this.initializeMultipleRows(b.lastValues,a.idServer,a.lastValues,a),this.initializeRow(b.objectives,null,j(a.objectives),a),b.name=a.name,b.id=a.idIndicator,b.server=a.idServer,b.indicator=a,b.decimals=a.decimals||0},h.prototype.refreshRow=function(a){var b=this;c.get({id:a.idIndicator,startingPeriod:this.startingPeriod,periodCount:this.periodCount}).$promise.then(function(a){b.setRow(a)})},h.prototype.deleteRow=function(a){var b=this.findRow(a);b&&this.grid.splice(this.grid.indexOf(b),1)},h.prototype.initializeGridHeaders=function(){for(var a=[],b=[],c="",d=0;d<this.periodCount;d++){var e=this.startingPeriod+d,f=g.toMoment(e),h=f.format("YYYY");h!==c?b.push({name:h,span:1}):b[b.length-1].span++,a.push({billingPeriod:e,name:f.format("MMMM")}),c=h}for(d=0;d<b.length;d++)b[d].width=1/this.periodCount*b[d].span;this.yearHeaders=b,this.monthHeaders=a},h}]),angular.module("lysasoftIndicators").directive("indicatorsGraph",["$document","$interval","$location",function(a,b,c){return{restrict:"E",templateUrl:"app/indicators/indicators-graph.html",replace:!0,scope:{currentIndicator:"<",currentIndicatorRow:"<",currentServer:"<",columnWidth:"<",headerWidth:"<"},link:function(c,d,e){var f=b(function(){var b=d[0].getBoundingClientRect();c.height=b.height,c.width=b.width;var e=a.find("svg")[0].getBBox();c.svgHeight=e.y+e.height,c.svgWidth=e.x+e.width},1e3);d.on("$destroy",function(){b.cancel(f)})}}}]),angular.module("lysasoftIndicators").controller("IndicatorsController",["$rootScope","$scope","$q","$injector","$uibModal","$window","appConfig","Modal","IndicatorGrid","Indicator","Server","indicatorEdit","valueEdit","User",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o=this;o.newIndicator=function(){l(a.config.currentServerId,o.indicators,null).then(function(a){o.grid.setRow(a)})},o.editIndicator=function(){l(a.config.currentServerId,o.indicators,o.currentIndicator).then(function(a){o.grid.setRow(a)})},o.deleteIndicator=h.confirm["delete"](function(){o.currentIndicator.$delete(),o.indicators.splice(o.indicators.indexOf(o.currentIndicator),1),o.grid.deleteRow(o.currentIndicator)}),o.selectRow=function(a){o.currentIndicatorRow=a,o.currentIndicatorRow?o.currentIndicator=o.currentIndicatorRow.indicator:o.currentIndicator=null},o.editValue=function(a,b,c){var d=b.idServer===o.thisServer.idServer||null==a.indicator.idIndicatorType;m(a.id,b.idServer,c.billingPeriod,d).then(function(a){o.grid.refreshRow(o.currentIndicator)})},o.updateWidth=function(){var a=(100-o.headerWidth)/o.state.periodCount;o.columnStyle.width=""+a+"%",o.columnWidth=1/o.state.periodCount},o.updateGrid=function(){o.updateWidth(),o.grid=new i,o.grid.load(o.state.startingPeriod,o.state.periodCount).then(function(a){o.indicators=a.indicators,o.indicatorGrid=a.grid,o.state.startingPeriod||(o.state.startingPeriod=a.startingPeriod),o.yearHeaders=a.yearHeaders,o.monthHeaders=a.monthHeaders,o.servers=a.servers})},o.updatePeriodCount=function(){o.periodCount&&(o.state.periodCount=o.periodCount)},o.reorder=function(a,b,c){var d=_.findIndex(o.indicatorGrid,a),e=_.findIndex(o.indicatorGrid,b),f=0>c?e:e+1;o.indicatorGrid.splice(d,1),o.indicatorGrid.splice(f>d?f-1:f,0,a),j.move({from:a.id,to:b.id,position:c})},o.state=g.state,o.periodCount=o.state.periodCount,o.headerWidth=20,o.columnStyle={width:"20%"},o.thisServer=k.me(),o.updateGrid(),b.$watch("vm.state",o.updateGrid,!0),b.$watch("vm.headerWidth",o.updateWidth)}]),angular.module("lysasoftIndicators").factory("textNoteEdit",["Modal",function(a){return function(b){return a.open({templateUrl:"app/indicators/text-note.html",controller:"TextNoteController",controllerAs:"vm",resolve:{value:function(){return b||""}}},{},"modal-text-note").result}}]).controller("TextNoteController",["$scope","value",function(a,b){var c=this;c.value=b,c.save=function(){return a.$close(c.value)},c.cancel=c.close=function(){a.$dismiss()}}]),angular.module("lysasoftIndicators").factory("valueEdit",["Modal",function(a){return function(b,c,d,e){return a.open({templateUrl:"app/indicators/value-edit.html",controller:"ValueEditController",controllerAs:"vm",resolve:{idIndicator:function(){return b},idServer:function(){return c},billingPeriod:function(){return d},editable:function(){return e}}},{},"modal-value-edit").result}}]).controller("ValueEditController",["$scope","$uibModalInstance","$window","Indicator","IndicatorValue","IndicatorAttachment","IndicatorType","AllBillingPeriods","textNoteEdit","Modal","Upload","User","idIndicator","idServer","billingPeriod","editable","appConfig",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){var r=this;r.billingPeriod=h.get({billingPeriod:+o}),r.inputValue=null,r.isEditable=p,r.loggedUser=l.logged(),r.saveValue=function(){r.value=new e({idIndicator:m,idServer:n,billingPeriod:o,value:r.inputValue}),r.saving=!0,r.value.$save().then(function(){r.saving=!1}),r.values.push(r.value)},r.close=function(){return a.$close(r.value)},r.indicator=d.get({id:m}),r.indicator.$promise.then(function(){r.editingAllowed=q.user.permissions["ind.indicator.value"]&&(q.user.permissions["ind.indicator.all_values"]||!r.indicator.users.length||_(r.indicator.users).map("uuid").includes(q.user.user.uuid))}),r.values=e.query({idIndicator:m,idServer:n,billingPeriod:o}),r.graphSum=function(a){return _.values(a.graph).map(function(a){return a.value||0}).reduce(function(a,b){return a+b},0)},r.attachments=f.query({idIndicator:m,idServer:n,billingPeriod:o}),r.indicator.$promise.then(function(){r.indicator.idIndicatorType&&(r.isComputed=!0,r.computedValue=g.value({id:r.indicator.idIndicatorType,date:o})),r.title="Indicateur "+r.indicator.name}),r.files=[],a.$watch("vm.files",function(){r.upload()}),r.upload=function(){_.map(r.files,function(a){a.$error||k.upload({url:"/api/file/File",data:{file:a}}).then(function(a){if(a.data.length){var b=new f({idIndicator:m,idServer:n,billingPeriod:o,idFile:a.data[0].idFile});b.$save(),b.file=a.data[0],r.attachments.push(b)}},null,function(a){parseInt(100*a.loaded/a.total)})})},r.openAttachment=function(a){null===a.file||_.isUndefined(a.file)?r.editTextNote(a):a.file.complete&&c.open(a.url(),"_blank")},r.newTextNote=function(){i().then(function(a){var b=new f({idIndicator:m,idServer:n,billingPeriod:o,message:a});b.$save(),r.attachments.push(b)})},r.editTextNote=function(a){i(a.message).then(function(b){a.message=b,a.$save()})},r.deleteAttachment=j.confirm["delete"](function(a){a.$delete();var b=r.attachments.indexOf(a);b>=0&&r.attachments.splice(b,1)})}]),angular.module("lysasoftLogin").controller("LoginController",["$scope","$q","$location","$rootScope","User","reloadConfig",function(a,b,c,d,e,f){var g=this;g.loginDisabled=!1,g.login="",g.password="",g.failed=!1,g.clearError=function(){g.error=!1},g.doLogin=function(){g.loginDisabled=!0,d.config.user=e.login({username:g.login,password:g.password}),d.config.user.$promise.then(function(){g.loginDisabled=!1,f(),c.url("/main")},function(){g.loginDisabled=!1,g.error=!0})}}]),angular.module("lysasoftMain").directive("alert",["$compile","$templateRequest","$document","Upload","appConfig",function(a,b,c,d,e){return{restrict:"EA",templateUrl:"app/main/alert.html",scope:{sentAlert:"=",open:"&onOpen"},link:function(a,b,c,d){a.config=e}}}]),angular.module("lysasoftMain").filter("currentAlert",function(){return function(a){return a.filter(function(a){return moment(a.expiresDate).startOf("day")>=moment().startOf("day")})}}),angular.module("lysasoftMain").filter("expiredAlert",function(){return function(a){return a.filter(function(a){return moment(a.expiresDate).startOf("day")<moment().startOf("day")})}}),angular.module("lysasoftMain").controller("MainController",["$location","SentAlert","SentAlertEmail","Server","appConfig",function(a,b,c,d,e){var f=this;f.openAlert=function(b){e.currentServerId=b.server.idServer,b.billingPeriod&&(e.state.startingPeriod=b.billingPeriod),a.path("/indicators")},f.openIndicator=function(b){e.currentServerId=b.idServer,a.path("/indicators")},f.sentAlerts=b.query({newer:moment().subtract(1,"month").toISOString()}),f.servers=d.query(),f.sentAlerts.$promise.then(function(){b.viewed()})}]),angular.module("lysasoftSetup").config(["$routeProvider",function(a){a.when("/setup/backup",{templateUrl:"app/setup/backup/backup.html",
controller:"BackupController",controllerAs:"vm"})}]).controller("BackupController",["$scope","Modal","Backup","BackupType",function(a,b,c,d){var e=this;e.selectRow=function(a){e.currentRow=a},e.changed=function(a){a.idBackup&&a.$save()},e.newBackup=function(){var a=new Date;a.setHours(12),a.setMinutes(0);var b=new c({idBackupType:1,time:a});e.backups.push(b),b.$save()},e.deleteBackup=b.confirm["delete"](function(){e.currentRow.$delete(),_.remove(e.backups,function(a){return a===e.currentRow}),e.currentRow=null}),e.backupTypes=d.query(),e.backups=c.query()}]),angular.module("lysasoftSetup").factory("domainEdit",["Modal","Domain","openEdit",function(a,b,c){return function(a,d){return c({templateUrl:"app/setup/domains/domain-edit.html",controller:"DomainEditController"},a,d||new b,!d)}}]).controller("DomainEditController",["$scope","$controller","Modal","isNew","document","collection",function(a,b,c,d,e,f){var g=this;angular.extend(g,b("EditController",{$scope:a,isNew:d,document:e,collection:f})),d?(g.title="Nouveau domaine",g.document.name=""):g.title="Éditer le domaine"}]),angular.module("lysasoftSetup").component("domain",{templateUrl:"app/setup/domains/domain.component.html",bindings:{domain:"<",isSelected:"<"}}),angular.module("lysasoftSetup").config(["$routeProvider",function(a){a.when("/setup/domains",{templateUrl:"app/setup/domains/domains.html",controller:"DomainsController",controllerAs:"vm"})}]).controller("DomainsController",["$scope","appConfig","Server","Domain","domainEdit","Modal",function(a,b,c,d,e,f){var g=this;g.newDomain=function(){e(g.domains,null)},g.editDomain=function(a){b.user.permissions["prm.domains.update"]&&e(g.domains,a||g.selectedDomain)},g.deleteDomain=f.confirm["delete"](function(){g.selectedDomain.$delete(),g.domains.splice(g.domains.indexOf(g.selectedDomain),1)}),g.domains=d.query()}]),angular.module("lysasoftSetup").factory("groupEdit",["Modal","Group","openEdit",function(a,b,c){return function(a,d){return c({templateUrl:"app/setup/groups/group-edit.html",controller:"GroupEditController"},a,d||new b,!d)}}]).controller("GroupEditController",["$scope","$controller","appConfig","Modal","Server","Permission","isNew","document","collection",function(a,b,c,d,e,f,g,h,i){var j=this;angular.extend(j,b("EditController",{$scope:a,isNew:g,document:h,collection:i})),a.$watch("vm.document.permissions",function(){j.document.isAdmin||(j.document.set_permissions=_(j.document.permissions).keyBy("idPermission").mapValues(Boolean).value())}),j.permissionFilter={idServer:j.document.idServer,webGroup:c.server.dashboardOnly||void 0},j.selectAll=function(){j.document.set_permissions=_(j.permissions).keyBy("idPermission").mapValues(Boolean).value()},j.unselectAll=function(){j.document.set_permissions=_(j.permissions).keyBy("idPermission").mapValues(function(a){return!a}).value()},g?(j.title="Nouvel groupe",j.document.idServer=null,j.document.title=""):j.title="Éditer le groupe",j.document.password=null,j.document.passwordConfirm=null,(j.thisServer=e.me()).$promise.then(function(){j.document.idServer=j.document.idServer||j.thisServer.idServer}),j.servers=e.query(),j.permissions=f.query()}]),angular.module("lysasoftSetup").config(["$routeProvider",function(a){a.when("/setup/groups",{templateUrl:"app/setup/groups/groups.html",controller:"GroupsController",controllerAs:"vm"})}]).controller("GroupsController",["$scope","appConfig","Group","Server","groupEdit","Modal",function(a,b,c,d,e,f){var g=this;g.newGroup=function(){e(g.groups,null)},g.editGroup=function(a){b.user.permissions["prm.group.update"]&&e(g.groups,a||g.selectedGroup)},g.deleteGroup=f.confirm["delete"](function(){g.selectedGroup.$delete(),g.groups.splice(g.groups.indexOf(g.selectedGroup),1)}),g.groups=c.query(),g.thisServer=d.me(),g.servers=d.query()}]),angular.module("lysasoftSetup").factory("serverEdit",["Modal","Server","openEdit",function(a,b,c){return function(a,d){return c({templateUrl:"app/setup/servers/server-edit.html",controller:"ServerEditController"},a,d||new b,!d)}}]).controller("ServerEditController",["$scope","$controller","Modal","Server","Group","Domain","Upload","isNew","document","collection",function(a,b,c,d,e,f,g,h,i,j){var k=this;angular.extend(k,b("EditController",{$scope:a,isNew:h,document:i,collection:j})),h?k.title="Nouveau server":k.title="Éditer le serveur",k.thisServer=d.me(),k.domains=f.query()}]),angular.module("lysasoftSetup").config(["$routeProvider",function(a){a.when("/setup/servers",{templateUrl:"app/setup/servers/servers.html",controller:"ServersController",controllerAs:"vm"})}]).controller("ServersController",["$scope","Modal","appConfig","Server","Synchronization","serverEdit",function(a,b,c,d,e,f){var g=this;g.newServer=function(){f(g.servers,null)},g.editServer=function(a){c.user.permissions["prm.server.update"]&&f(g.servers,a||g.selectedServer)},g.newSync=b.confirm.ask({html:"<p>Êtes-vous sûr de vouloir créer une nouvelle clé de synchronization ?</p>"},function(){(new e).$save().then(function(a){g.synchronizations.push(a)})}),g.deleteSync=b.confirm["delete"](function(){g.selectedSynchronization.$delete(),g.synchronizations.splice(g.synchronizations.indexOf(g.selectedSynchronization),1)}),g.select=function(a){a instanceof d?(g.selectedServer=a,g.selectedSynchronization=null):a instanceof e&&(g.selectedSynchronization=a,g.selectedServer=null)},g.me=d.me(),g.servers=d.query(),g.synchronizations=e.query({noServer:!0})}]),angular.module("lysasoftSetup").config(["$routeProvider",function(a){a.when("/setup/sync",{templateUrl:"app/setup/sync/sync.html",controller:"SyncController",controllerAs:"vm"})}]).controller("SyncController",["$scope","Modal","Server","Synchronization",function(a,b,c,d){var e=this;e.saveServer=function(){e.savingServer=!0,e.me.$save(function(a){e.savingServerStatus={success:!0},e.savingServer=!1},function(a){e.savingSyncStatus=a})},e.saveSync=function(a){e.savingSync=!0,a.$save(function(a){e.savingSyncStatus={success:!0},e.savingSync=!1},function(a){e.savingSyncStatus=a})},e.testSync=function(a){e.testResult=angular.copy(a),e.testResult.$test()},e.me=c.me(),e.synchronizations=d.query()}]),angular.module("lysasoftSetup").factory("userEdit",["Modal","User","openEdit",function(a,b,c){return function(a,d){return c({templateUrl:"app/setup/users/user-edit.html",controller:"UserEditController"},a,d||new b,!d)}}]).controller("UserEditController",["$scope","$controller","Modal","Server","Domain","Group","appConfig","isNew","document","collection",function(a,b,c,d,e,f,g,h,i,j){var k=this;angular.extend(k,b("EditController",{$scope:a,isNew:h,document:i,collection:j})),a.$watch("vm.document.groups",function(){!g.user.permissions["prm.group.protected"]&&_.filter(k.document.groups,function(a){return a.isProtected}).length&&(k.readonly=!0);var a=_(k.document.groups).keyBy("idGroup").mapValues(Boolean).value();k.document.isLocked||(k.document.set_groups=a)}),a.$watch("vm.document.domains",function(){var a=_.map(k.document.domains,"idDomain");!g.user.permissions["prm.domains.all"]&&_.difference(a,g.user.domains).length&&(k.readonly=!0),k.document.isLocked||(k.document.set_domains=a)}),h?(k.title="Nouvel utilisateur",k.document.idServer=null,k.document.title=""):k.title="Éditer l’utilisateur",k.document.password=null,k.document.passwordConfirm=null,k.document.idServer=k.document.idServer||g.currentServerId||g.server.idServer,k.thisServer=d.me();var l=k.save;k.save=function(){k.document.isLocked||k.document.idServer!==k.thisServer.idServer||k.domains&&1===k.domains.length&&(k.document.set_domains=[k.domains[0].idDomain]),l()},k.servers=d.query(),k.groups=f.query(),k.domains=e.query()}]),angular.module("lysasoftSetup").component("user",{templateUrl:"app/setup/users/user.component.html",bindings:{user:"<",isSelected:"<"},controller:["appConfig",function(a){var b=this;b.isServerUser=function(){return b.user.idServer===a.server.idServer}}]}),angular.module("lysasoftSetup").config(["$routeProvider",function(a){a.when("/setup/users",{templateUrl:"app/setup/users/users.html",controller:"UsersController",controllerAs:"vm"})}]).controller("UsersController",["$scope","appConfig","Server","User","userEdit","Modal",function(a,b,c,d,e,f){var g=this;g.newUser=function(){e(g.users,null)},g.editUser=function(a){b.user.permissions["prm.edit_user"]&&e(g.users,a||g.selectedUser)},g.deleteUser=f.confirm["delete"](function(){g.selectedUser.$delete(),g.users.splice(g.users.indexOf(g.selectedUser),1)}),g.thisServer=c.me(),g.servers=c.query(),g.users=d.query()}]),angular.module("lysasoftComponents").factory("colorScale",function(){return["#6599FF","#699935","#FF7626","#CE3101","#FDEA04","#CC59A8","#AAAAAA","#5775AF","#527131","#B35924","#902707","#D2C200","#8A3B71","#666666","#000000"]}),angular.module("lysasoftComponents").directive("dateselect",["$compile","$templateRequest","$document",function(a,b,c){return{restrict:"EA",templateUrl:"components/dateselect/dateselect.html",transclude:!0,require:["ngModel"],scope:{change:"&onChange",minDate:"=",maxDate:"="},link:function(d,e,f,g){var h=g[0],i=function(a){d.isOpen&&!e.find(a.target).length&&d.$apply(function(){d.isOpen=!1})};d.$watch("isOpen",function(f){function g(){f?(h.find(".dateselect-dropdown").css("display","block"),c.bind("click",i)):(h.find(".dateselect-dropdown").css("display","none"),c.unbind("click",i))}var h=e.find("[dateselect-popup]");""===h.text()?f&&b("components/dateselect/dateselect-popup.html").then(function(b){h.html(b),a(h.contents())(d),g()}):g()}),d.open=function(){d.isOpen=1},d.dateSelection=function(a){angular.isDefined(a)&&(d.date=a),h.$setViewValue(d.date),h.$render(),d.isOpen=!1,d.change(a)},d.select=function(a){if("today"===a){var b=new Date;angular.isDate(h.$modelValue)?(a=new Date(h.$modelValue),a.setFullYear(b.getFullYear(),b.getMonth(),b.getDate())):a=new Date(b.setHours(0,0,0,0))}d.dateSelection(a)},d.close=function(){d.isOpen=!1,e[0].focus()}}}}]),function(){var a;angular.module("lysasoftComponents").directive("draggableGridHeader",["$window",function(b){return{replace:!1,restrict:"A",scope:{draggableValue:"<",draggableDisabled:"<",onDrop:"&"},link:function(c,d,e){function f(b){a=c.draggableValue}function g(){}function h(b){a.id===c.draggableValue.id&&b.preventDefault()}function i(b){if(a.server===c.draggableValue.server){b.preventDefault();var d=angular.element(b.currentTarget),e=b.target.getBoundingClientRect();b.clientY-e.top<e.height/2?(d.addClass("draggable-grid-headed--drag-before"),d.removeClass("draggable-grid-headed--drag-after")):(d.removeClass("draggable-grid-headed--drag-before"),d.addClass("draggable-grid-headed--drag-after")),c.$apply()}}function j(a){a.preventDefault();var b=angular.element(a.currentTarget);b.removeClass("draggable-grid-headed--drag-before"),b.removeClass("draggable-grid-headed--drag-after")}function k(b){var d=b.target.getBoundingClientRect(),e=angular.element(b.currentTarget);e.removeClass("draggable-grid-headed--drag-before"),e.removeClass("draggable-grid-headed--drag-after"),c.onDrop({reorderValue:a,positionValue:c.draggableValue,position:b.clientY-d.top<d.height/2?-1:1}),c.$apply()}angular.element(b);c.$watch("draggableDisabled",function(){d.attr("draggable",!c.draggableDisabled)}),d.on("dragstart",f),d.on("dragend",g),d.on("dragenter",h),d.on("dragleave",j),d.on("dragover",i),d.on("drop",k)}}}])}(),angular.module("lysasoftComponents").factory("openEdit",["Modal",function(a){return function(b,c,d,e){var f=angular.extend({controllerAs:"vm",resolve:{collection:function(){return c},document:function(){return d},isNew:function(){return e}}},b),g=a.open(f);return g.result}}]).controller("EditController",["$scope","isNew","document","collection",function(a,b,c,d){var e=this;e.isNew=b,e.document=angular.copy(c),e.save=function(){var f=a.vm.form;f.$setSubmitted(),f.$valid&&(angular.copy(e.document,c),c.$save().then(function(){return b&&d.push(c),a.$close(c)}))},e.cancel=function(){a.$dismiss()}}]),angular.module("lysasoftComponents").factory("billingPeriodConverter",function(){var a={fromDate:function(a){return a?Math.floor(moment(a).diff(moment("1900-01-01"),"months",!0))-1:a},fromNow:function(){return a.fromDate(new Date)},toMoment:function(a){return a?moment("1900-01-01").add(a+1,"months"):a},toDate:function(b){return b?a.toMoment(b).toDate():b}};return a}).directive("billingPeriod",["billingPeriodConverter",function(a){return{restrict:"A",require:"ngModel",link:function(b,c,d,e){function f(b){return a.fromDate(b)}function g(b){return a.toDate(b)}e.$parsers.push(f),e.$formatters.push(g)}}}]),angular.module("lysasoftComponents").directive("compareTo",function(){return{require:"ngModel",scope:{otherModelValue:"=compareTo"},link:function(a,b,c,d){d.$validators.compareTo=function(b){return b==a.otherModelValue},a.$watch("otherModelValue",function(){d.$validate()})}}}),angular.module("lysasoftComponents").directive("convertToNumber",function(){return{require:"ngModel",link:function(a,b,c,d){d.$parsers.push(function(a){return parseInt(a,10)}),d.$formatters.push(function(a){return""+a})}}}),angular.module("lysasoftComponents").directive("input",function(){return{restrict:"E",require:"?ngModel",link:function(a,b,c,d){function e(a){0>+a?b.addClass("negative"):b.removeClass("negative")}("mw-money"===c.type||"money"===c.type)&&(a.$watch(c.ngModel,function(){e(a.$eval(c.ngModel))}),b.on("input change",function(){var b=this.value.replace(/[^0-9\-\.,]/g,"");b=b.replace(/(?!^)-/g,"");var c=b.split(/[\.,]/),f=[c.shift()];c.length&&f.push(c.join("")),b=f.join("."),b.length||(b=null),e(b),a.$apply(function(){d.$setViewValue(b),d.$render()})}))}}}).directive("money",function(){return{restrict:"C",template:"{{ value | number }}",scope:{value:"="},link:function(a,b,c){a.$watch("value",function(){+a.value<0?b.addClass("negative"):b.removeClass("negative")})}}}),angular.module("lysasoftComponents").directive("showValidation",function(){return{restrict:"A",link:function(a,b,c,d){function e(c){var d=c.find("input[ng-model],textarea[ng-model]").attr("name");if(d){var e=b.attr("name")+".$submitted",f=b.attr("name")+"."+d+".$invalid";a.$watchGroup([e,f],function(a){c.toggleClass("has-error",a[0]&&a[1])})}}"form"===b.get(0).nodeName.toLowerCase()?b.find(".form-group").each(function(a,b){e(angular.element(b))}):e(b)}}}),angular.module("lysasoftComponents").filter("serverFilter",function(){return function(a,b){return _(a).values().filter(function(a){return null===b||a.server.idServer===b}).value()}}).directive("graphsLineChart",["$compile","$templateRequest","$document",function(a,b,c){return{restrict:"EA",templateUrl:"components/graphs/line/chart.html",scope:{indicator:"<",row:"<",currentServer:"<server",columnWidth:"<",headerWidth:"<",width:"@",height:"@"},link:function(a,b,c,d){a.pointCoordY=function(b){return a.indicator?10+(a.height-20)/(a.indicator.limitMax-a.indicator.limitMin)*(a.indicator.limitMax-b)||0:0},a.columnX=function(){return a.columnWidth*a.width*(100-a.headerWidth)/100},a.headerX=function(){return a.width*a.headerWidth/100},a.isFinite=isFinite}}}]),angular.module("lysasoftComponents").factory("graphsLineObjectivePath",["SvgPath",function(a){return function(b,c,d,e){var f=new a,g=!0;return b.objectives.map(function(a){return{x:d/2+(a.billingPeriod-c)*d,y:e(a.value)}}).forEach(function(a){g?f.add("M",a.x,a.y):f.add("L",a.x,a.y),g=!1}),f.toString()}}]),angular.module("lysasoftComponents").directive("graphsPieMultiple",["$compile","$templateRequest","$document",function(a,b,c){return{restrict:"EA",templateUrl:"components/graphs/pie/multiple.html",scope:{indicator:"<",row:"<",server:"<",columnWidth:"<",headerWidth:"<",width:"<",height:"<"},link:function(a,b,c,d){a.$watch("row.lastValues",function(){a.values=_.values(a.row.lastValues)}),a.setServer=function(b){a.server=b.idServer},a.columnX=function(){return a.columnWidth*a.width*(100-a.headerWidth)/100},a.headerX=function(){return a.width*a.headerWidth/100}}}}]),angular.module("lysasoftComponents").factory("graphsPiePath",["colorScale","SvgPath",function(a,b){return function(c,d){var e=[];if(!c)return e;var f=_(c).map(function(a){return a.value||0}).reduce(function(a,b){return a+b});if(!f)return e;var g=0,h=0;for(var i in c){var j=c[i],k=g,l=g=k+(j.value||0);k=2*Math.PI*k/f,l=2*Math.PI*l/f;var m,n,o=d*Math.cos((l+k)/2)*.9,p=-d*Math.sin((l+k)/2)*.9;j.value===f?(m=(new b).add("M",d,0).add("A",d,d,0,1,0,-d,0).add("A",d,d,0,1,0,d,0).add("Z"),o=0,p=0,n="middle"):(m=(new b).add("M",0,0).add("L",d*Math.cos(k),-d*Math.sin(k)).add("A",d,d,0,l-k>Math.PI?1:0,0,d*Math.cos(l),-d*Math.sin(l)).add("Z"),n=o>0?"end":"start"),e.push({header:j.header,color:a[h%a.length],value:j.value||0,mx:o,my:p,anchor:n,path:m.toString()}),h++}return e}}]),angular.module("lysasoftComponents").directive("graphsPieSingle",["$compile","$templateRequest","$document","$location","graphsPiePath",function(a,b,c,d,e){return{restrict:"EA",templateUrl:"components/graphs/pie/single.html",scope:{value:"<",pieWidth:"@width"},link:function(a,b,c,f){a.$watch("[value, pieWidth]",function(b,c){a.graph=e(a.value,.4*a.pieWidth)},!0),a.loc=d.path()}}}]),angular.module("lysasoftComponents").directive("imageUpload",["$compile","$templateRequest","$document","Upload",function(a,b,c,d){return{restrict:"EA",templateUrl:"components/image-upload/image-upload.html",require:["ngModel"],scope:{value:"=",width:"=",height:"="},link:function(a,b,c,e){var f=e[0];a.upload=function(){a.file&&!a.file.$error&&d.upload({url:"/api/file/File",data:{file:a.file}}).then(function(a){f.$setViewValue(a.data[0].idFile)},null,function(a){})},a.$watch("file",function(){a.upload()})}}}]),angular.module("lysasoftComponents").directive("layoutNavbar",function(){return{restrict:"EA",replace:!0,transclude:!0,templateUrl:"components/layout/navbar.html"}}).directive("layoutPage",function(){return{link:function(a,b,c){b.addClass("layout-page")}}}).directive("layoutSidebar",function(){return{link:function(a,b,c){b.addClass("layout-sidebar")}}}).directive("layoutContent",function(){return{link:function(a,b,c){b.addClass("layout-content")}}}).directive("layoutContentHeader",function(){return{restrict:"EA",replace:!0,transclude:!0,templateUrl:"components/layout/content-header.html"}}).directive("layoutContentBody",function(){return{restrict:"EA",replace:!0,transclude:!0,templateUrl:"components/layout/content-body.html"}}).directive("layoutContentFooter",function(){return{restrict:"EA",templateUrl:"components/layout/content-footer.html",transclude:!0,replace:!0,link:function(a,b,c){a.footerHeight=300}}}).directive("layoutContentSplitter",["$window",function(a){return{restrict:"C",link:function(b,c,d){b.startDrag=function(c){var d=angular.element(a),e=c.pageY,f=b.footerHeight,g=function(a){b.footerHeight=f-a.pageY+e,b.$apply()},h=function(a){a.preventDefault(),d.unbind("mousemove",g),d.unbind("mouseup",h)};c.preventDefault(),d.bind("mousemove",g),d.bind("mouseup",h)}}}}]),angular.module("lysasoftComponents").service("navbarMenu",function(){var a=[];return a}).controller("NavbarCtrl",["$scope","$location","navbarMenu",function(a,b,c){a.menu=c,a.isCollapsed=!0,a.isActive=function(a){return a===b.path()}}]),angular.module("lysasoftComponents").directive("serverSidebar",["$compile","$templateRequest","$document","appConfig",function(a,b,c,d){return{replace:!1,restrict:"EA",templateUrl:"components/layout/server-sidebar.html",scope:{defaultText:"@",servers:"=",currentServerId:"="},link:function(a,b,c,e){b.addClass("layout-sidebar").addClass("layout-sidebar-secondary"),a.config=d,a.setServer=function(b){a.currentServerId=b&&b.idServer}}}}]),angular.module("lysasoftComponents").factory("Modal",["$rootScope","$uibModal",function(a,b){function c(c,d,e){var f=a.$new();return d=d||{},angular.extend(f,d),c=_.defaults(c,{scope:f,templateUrl:"components/modal/modal.html",windowClass:e||"modal modal-default"}),b.open(c)}function d(a,b,d){var e;d=d||angular.noop;var f=_.extend({dismissable:!0,title:"Lysasoft",html:"?",buttons:[{classes:"btn-primary",text:"OK",click:function(a){this.close(a)}},{classes:"btn-default",text:"Annuler",click:function(a){this.dismiss(a)}}]},b);_.each(f.buttons,function(a){var b=a.click;a.click=function(){b.call(e)}}),e=c(a,f,f.modalClass),e.result.then(d)}return{open:c,question:d,info:function(a,b){var c=_.extend({title:"Lysasoft",buttons:[{classes:"btn-primary",text:"OK",click:function(a){this.close(a)}}]},a);return d({},c,b||angular.noop)},confirm:{ask:function(a,b){return function(c){var e=_.extend({title:"Lysasoft",buttons:[{classes:"btn-warning",text:"OK",click:function(a){this.close(a)}},{classes:"btn-default",text:"Annuler",click:function(a){this.dismiss(a)}}]},a);return d({windowClass:"modal-warning"},e,b||angular.noop)}},"delete":function(a){return function(b,c){return d({windowClass:"modal-danger"},{title:"Confirmer la suppression",html:"<p>Êtes-vous sûr de vouloir supprimer <strong>"+b+"</strong> ?</p>",buttons:[{classes:"btn-danger",text:"Supprimer",click:function(a){this.close(c)}},{classes:"btn-default",text:"Annuler",click:function(a){this.dismiss(a)}}]},a)}}}}}]),angular.module("lysasoftComponents").directive("periodPicker",["$compile","$templateRequest","$document","Upload","billingPeriodConverter",function(a,b,c,d,e){return{restrict:"EA",templateUrl:"components/period-picker/period-picker.html",scope:{model:"=ngModel"},link:function(a,b,c,d){a.open=!1,a.date=e.toDate(a.model),a.$watch("date",function(){a.model=e.fromDate(a.date)}),a.datepickerOptions={datepickerMode:"month",minMode:"month"}}}}]),angular.module("lysasoftComponents").component("selectUsers",{templateUrl:"components/select-users/select-users.html",controller:"SelectUsersController",bindings:{ngModel:"=",users:"<",filter:"<"}}),angular.module("lysasoftComponents").controller("SelectUsersController",function(){}),angular.module("lysasoftComponents").factory("SvgPath",["$rootScope","$uibModal",function(a,b){function c(){this.string=""}return c.prototype={},c.prototype.add=function(){return this.string.length&&(this.string+=" "),this.string+=Array.prototype.join.call(arguments," "),this},c.prototype.toString=function(){return this.string},c}]),angular.module("lysasoft").run(["$templateCache",function(a){a.put("app/alerts/alert-edit.html",'<div class=modal-header><button type=button ng-click=$dismiss() class=close>&times;</button><h3 class=modal-title>{{vm.title}}</h3></div><div class=modal-body><form class=form-horizontal role=form><fieldset ng-disabled=vm.disabled><div class=form-group><div class=col-sm-12><input required class=form-control name=title ng-model=vm.alert.title placeholder="Titre de l’alerte"></div></div><div class=form-group ng-if=config.isMultiServer()><div class=col-sm-12><ui-select multiple ng-model=vm.alert.set_servers theme=bootstrap reset-search-input=false title="Choisir une adresse"><ui-select-match placeholder=Serveurs>{{$item.name}}</ui-select-match><ui-select-choices repeat="server.idServer as server in vm.servers"><div ng-bind-html="server.name | highlight: $select.search"></div></ui-select-choices></ui-select></div></div><div class=form-group><div class=col-sm-12><h4>Type d’alerte</h4></div></div><div class=form-group><div class=col-sm-12><div class=radio><label><input type=radio name=alertType ng-value=1 ng-model=vm.alert.alertType> Un évènement ou une action planifiés arrivent à échéance</label></div><div class=radio><label><input type=radio name=alertType ng-value=2 ng-model=vm.alert.alertType> Des indicateurs de la période</label><select class="form-control inline" ng-model=vm.alert.period><option ng-value=0>Courante</option><option ng-value=-1 selected>Précédente</option><option ng-value=-2>n-2</option><option ng-value=-3>n-3</option></select>ne sont pas renseignés</div><div class=radio><label><input type=radio name=alertType ng-value=3 ng-model=vm.alert.alertType> Des indicateurs de la période</label><select class="form-control inline" ng-model=vm.alert.period><option ng-value=0>Courante</option><option ng-value=-1 selected>Précédente</option><option ng-value=-2>n-2</option><option ng-value=-3>n-3</option></select>dépassent les seuils</div></div></div><div class=form-group><div class=col-sm-12><h4>Date d’envoi de l’alerte</h4></div></div><div class=form-group><div class=col-sm-12><div class=input-group><label class=input-group-addon><input type=radio name=sendDateType ng-value=1 ng-model=vm.alert.sendDateType> Le</label><input type=number class=form-control ng-model=vm.alert.sendMonthDay><div class=input-group-addon>de chaque mois</div></div></div></div><div class=form-group><div class=col-sm-12><div class=input-group><label class=input-group-addon><input type=radio name=sendDateType ng-value=2 ng-model=vm.alert.sendDateType> Le</label><select class=form-control ng-model=vm.alert.sendWeekDayNumber><option ng-value=1>Premier</option><option ng-value=2>Deuxième</option><option ng-value=3>Troisième</option><option ng-value=4>Quatrième</option><option ng-value=-1>Dernier</option></select><select class=form-control ng-model=vm.alert.sendWeekDay><option ng-value=1>Lundi</option><option ng-value=2>Mardi</option><option ng-value=3>Mercredi</option><option ng-value=4>Jeudi</option><option ng-value=5>Vendredi</option><option ng-value=6>Samedi</option><option ng-value=7>Dimanche</option></select><div class=input-group-addon>de chaque mois</div></div></div></div><div class=form-group><div class=col-sm-12><div class=input-group><label class=input-group-addon><input type=radio name=sendDateType ng-value=3 ng-model=vm.alert.sendDateType> Le</label><input class=form-control uib-datepicker-popup is-open=vm.sendPopupOpened datepicker-options=dateOptions close-text=Fermer alt-input-formats=altInputFormats ng-model=vm.alert.sendFixedDate ng-model-options="{timezone: \'utc\'}"> <span class=input-group-btn><button type=button class="btn btn-default" ng-click="vm.sendPopupOpened = true"><i class="glyphicon glyphicon-calendar"></i></button></span></div></div></div><div class=form-group><div class=col-sm-12><h4>Date de l’évènement</h4></div></div><div class=form-group><div class=col-sm-12><div class=input-group><label class=input-group-addon><input type=radio name=eventDateType ng-value=1 ng-model=vm.alert.eventDateType> Le</label><input type=number class=form-control ng-model=vm.alert.eventMonthDay><div class=input-group-addon>de chaque mois</div></div></div></div><div class=form-group><div class=col-sm-12><div class=input-group><label class=input-group-addon><input type=radio name=eventDateType ng-value=2 ng-model=vm.alert.eventDateType> Le</label><select class=form-control ng-model=vm.alert.eventWeekDayNumber><option ng-value=1>Premier</option><option ng-value=2>Deuxième</option><option ng-value=3>Troisième</option><option ng-value=4>Quatrième</option><option ng-value=-1>Dernier</option></select><select class=form-control ng-model=vm.alert.eventWeekDay r><option ng-value=1>Lundi</option><option ng-value=2>Mardi</option><option ng-value=3>Mercredi</option><option ng-value=4>Jeudi</option><option ng-value=5>Vendredi</option><option ng-value=6>Samedi</option><option ng-value=7>Dimanche</option></select><div class=input-group-addon>de chaque mois</div></div></div></div><div class=form-group><div class=col-sm-12><div class=input-group><label class=input-group-addon><input type=radio name=eventDateType ng-value=3 ng-model=vm.alert.eventDateType> Le</label><input class=form-control uib-datepicker-popup is-open=vm.eventPopupOpened datepicker-options=dateOptions close-text=Fermer alt-input-formats=altInputFormats ng-model=vm.alert.eventFixedDate ng-model-options="{timezone: \'utc\'}"> <span class=input-group-btn><button type=button class="btn btn-default" ng-click="vm.eventPopupOpened = true"><i class="glyphicon glyphicon-calendar"></i></button></span></div></div></div><div class=form-group><div class=col-sm-12><h4>Envoyer à</h4></div></div><div class=form-group><div class=col-sm-12><div class=checkbox><label><input type=checkbox name=sendToIndicatorOwners ng-disabled="!(+vm.alert.alertType === 2 || +vm.alert.alertType === 3)" ng-value=true ng-model=vm.alert.sendToIndicatorOwners> Envoyer aux propriétaires de l’indicateur</label></div></div></div><div class=form-group><div class=col-sm-12><div class=modal-grid><div class=modal-grid-body><div class="row modal-grid-row" ng-class="$even ? even : odd" ng-repeat="email in vm.alertEmails"><div class="col col-sm-5 modal-grid-col"><input placeholder=email ng-model=email.email class="form-control input-sm"></div><div class="col col-sm-5 modal-grid-col"><select class=form-control ng-model=email.idUser ng-change=vm.userUpdated(email) ng-options="user.uuid as user.login + \' (\' + user.server.name +\')\' for user in vm.users | filter:{isValid: true}"><option value="">Autre</option></select></div><div class="col col-sm-2 modal-grid-col modal-grid-button-col"><button class=pictogram ng-click="vm.deleteEmail(\'cet email\', $index)"><span class="glyphicon glyphicon-minus-sign"></span></button></div></div></div><div class=row><div class="col col-sm-10 modal-grid-col"></div><div class="col col-sm-2 modal-grid-col modal-grid-button-col"><button class=pictogram ng-click=vm.newEmail()><span class="glyphicon glyphicon-plus-sign"></span></button></div></div></div></div></div></fieldset></form></div><div class=modal-footer><button ng-click=vm.save() ng-disabled="!vm.alert.sendToIndicatorOwners && !vm.alertEmails.length" class="btn btn-primary">OK</button> <button ng-click=vm.cancel() class=btn>Annuler</button></div>'),a.put("app/alerts/alerts.html",'<layout-navbar></layout-navbar><layout-page id=page-alerts><layout-sidebar ng-show="\n    config.user.permissions[\'ind.alert.insert\'] ||\n    config.user.permissions[\'ind.alert.update\'] ||\n    config.user.permissions[\'ind.alert.delete\']"><button class=btn ng-click=vm.newAlert() ng-if="config.user.permissions[\'ind.alert.insert\']"><i class="fa fa-plus-circle"></i> Nouvelle</button> <button class="btn btn-default" ng-click=vm.editAlert(vm.currentAlert) ng-disabled=!vm.currentAlert ng-if="config.user.permissions[\'ind.alert.update\']"><i class="fa fa-edit"></i> Éditer</button> <button class="btn btn-default" ng-click=vm.deleteAlert(vm.currentAlert.title) ng-disabled=!vm.currentAlert ng-if="config.user.permissions[\'ind.alert.delete\']"><i class="fa fa-minus-circle"></i> Supprimer</button></layout-sidebar><server-sidebar ng-if=config.isMultiServer() default-text="Serveurs multiples" current-server-id=config.currentServerId servers=vm.servers></server-sidebar><layout-content class=layout-content-light><layout-content-header><div class=grid><div class=grid-header-row><div class="grid-header-col-header-bg col-sm-4"></div><div class="col-sm-4 grid-header">Description</div><div class="col-sm-4 grid-header">Envoyé à</div><div class="col-sm-2 grid-header">Date d’envoi</div><div class="col-sm-2 grid-header">Date de l’évènement</div></div></div></layout-content-header><layout-content-body><div class="col-sm-4 grid-col-header-bg"></div><div class=grid><div class=grid-row ng-repeat="alert in vm.alerts | filter: { idServer: config.currentServerId } : true" ng-class="alert === vm.currentAlert ? \'current\' : \'\'" ng-click=vm.selectAlert(alert) ng-dblclick=vm.editAlert(alert)><div class="col-sm-4 grid-col grid-col-header"><div class=alerts-grid-alert-title>{{alert.title}}</div><div ng-if=config.isMultiServer() class=grid-header-subtitle><div ng-if=alert.servers.length><span class=alert-server ng-repeat="server in alert.servers">{{server.name}}</span></div></div><div class=grid-header-subtitle>{{alert.typeDescription()}}</div></div><div class="col-sm-4 grid-col"><span ng-if=alert.sendToIndicatorOwners>Propriétaires de l\'indicateur{{ alert.emails.length ? \', \' : \'\' }}</span> <span ng-repeat="email in alert.emails"><span class=alert-email ng-if=email.user>{{email.user.login}}</span> <span class=alert-email ng-if=email.email>({{email.email}})</span>{{$last ? \'\' : \', \'}}</span></div><div class="col-sm-2 grid-col">{{alert.sendDescription()}}</div><div class="col-sm-2 grid-col">{{alert.eventDescription()}}</div></div></div></layout-content-body></layout-content></layout-page>'),
a.put("app/cashflow/cashflow.html",'<layout-navbar></layout-navbar><layout-page><layout-sidebar><div class=btn-group-vertical><button class="btn btn-default" ng-click=vm.addPrediction() ng-disabled=!vm.isLastPeriod>Nouvelle prévision</button> <button class="btn btn-default" ng-click=vm.delayPrediction() ng-disabled="!vm.currentPrediction || !vm.isLastPeriod">Décaler la prévision</button> <button class="btn btn-default" ng-click=vm.cancelPrediction() ng-disabled="!vm.currentPrediction || !vm.isLastPeriod" ng-if=!vm.currentPrediction.canceled>Annuler la prévision</button> <button class="btn btn-default" ng-click=vm.restorePrediction() ng-disabled="!vm.currentPrediction || !vm.isLastPeriod" ng-if=vm.currentPrediction.canceled>Restaurer la prévision</button> <button class="btn btn-default" ng-click=vm.deletePrediction(vm.currentPrediction.description) ng-disabled="!vm.currentPrediction || !vm.isLastPeriod">Supprimer la prévision</button></div><button class="btn btn-default" ng-click=vm.editPredictionRecurrence() ng-disabled="!vm.isLastPeriod || !vm.currentPrediction">Prévision récurrente</button><div class=btn-group-vertical><button class="btn btn-default" ng-click=vm.closePeriod() ng-disabled=!vm.isLastPeriod>Clôturer la période</button> <button class="btn btn-default" ng-click=vm.reopenPeriod() ng-disabled=!vm.isLastClosedPeriod>Ré-ouvrir la période</button></div><button class="btn btn-default" ng-click=vm.exportData()>Exporter</button><select class=form-control ng-model=vm.currentPeriod ng-options="(period.date | date) for period in vm.periods | orderBy:\'date\':true "></select><div class="panel panel-primary" ng-if=vm.currentPeriod><div class=panel-heading><h3 class=panel-title>Période du {{ vm.currentPeriod.date | date }}</h3></div><div class=panel-body>Balance initiale: {{vm.currentPeriod.balance}}</div></div><label>Afficher jusqu’au</label><div class=form-control dateselect ng-model=vm.displayEndDate>{{ vm.displayEndDate | date }}</div></layout-sidebar><layout-content><layout-content-header><div class=grid><div class=grid-header-row><div class="col-sm-4 grid-header">Description</div><div class="col-sm-1 grid-header">Date prévisionnelle</div><div class="col-sm-2 grid-header">Montant prévu</div><div class="col-sm-2 grid-header">Montant réalisé</div><div class="col-sm-1 grid-header">Date effective</div><div class="col-sm-1 grid-header">Balance prévisionnelle</div><div class="col-sm-1 grid-header">Balance réalisée</div></div></div></layout-content-header><layout-content-body><div class=grid><div class=grid-row ng-repeat="prediction in vm.allPredictions | orderBy:\'predictedDate\'" ng-click=vm.selectRow(prediction) ng-class="prediction === vm.currentPrediction ? \'current\' : \'\'"><div class=col-sm-4 ng-if=!prediction.delayedFrom><input class="form-control light" ng-model=prediction.description ng-change=vm.changed(prediction) ng-model-options="{ debounce: 1000 }"></div><div class=col-sm-4 ng-if=prediction.delayedFrom><div class=prediction-delayed-description>Décalé: {{ prediction.delayedFrom.description }}</div></div><div class=col-sm-1><div class=prediction-date ng-model=prediction.predictedDate dateselect on-change=vm.changed(prediction)>{{ prediction.predictedDate | date }}</div></div><div class=col-sm-2><input type=mw-money class="form-control light" ng-model=prediction.predictedAmount ng-change=vm.changed(prediction) ng-model-options="{ debounce: 1000 }"></div><div class=col-sm-2 ng-if="!prediction.canceled && !prediction.idDelayedTo"><input type=mw-money class="form-control light" ng-model=prediction.realAmount ng-change=vm.changed(prediction) ng-model-options="{ debounce: 1000 }"></div><div class=col-sm-1 ng-if="!prediction.canceled && !prediction.idDelayedTo"><div class=prediction-date ng-model=prediction.realDate dateselect on-change=vm.changed(prediction)>{{ prediction.realDate | date }}</div></div><div class=col-sm-3 ng-if="prediction.idDelayedTo && !prediction.canceled"><div class=prediction-delayed-title>Décalée</div><div class=prediction-delayed-date ng-if=prediction.delayedTo.predictedDate>au {{ prediction.delayedTo.predictedDate | date }}</div></div><div class="col-sm-3 prediction-canceled" ng-if=prediction.canceled>Annulée</div><div class="col-sm-1 result money" value=prediction.predictedBalance></div><div class="col-sm-1 result money" value=prediction.realBalance></div></div></div></layout-content-body><layout-content-footer></layout-content-footer></layout-content></layout-page>'),a.put("app/cashflow/period-close.html",'<div class=modal-header><button ng-if=dismissable type=button ng-click=$dismiss() class=close>&times;</button><h4 ng-if=title ng-bind=title class=modal-title></h4></div><div class=modal-body><div class=form-horizontal role=form><div class=form-group><label class=col-sm-6>Date de clôture</label><div class=col-sm-6><div ng-model=closingDate dateselect min-date=currentPeriod.date on-change=dateChanged()>{{ closingDate | date }}</div></div></div><div class=form-group ng-if=!closingDate><div class=col-sm-12><div class="alert alert-info">Sélectionner une date de clôture</div></div></div><div class=form-group><label class=col-sm-6>Balance calculée à la fin de la période</label><div class="col-sm-6 money" value=summedBalance></div></div><div class=form-group ng-if=unresolvedCount><div class=col-sm-12><div class="alert alert-danger"><ng-pluralize count=unresolvedCount when="{\'0\': \'Il n’y a aucune prévision non réalisée\',\n                   \'one\': \'Il y a une prévision non réalisée\',\n                   \'other\': \'Il y a {} prévisions non réalisées\'}"></ng-pluralize>avant la date de clôture. Il est nécessaire de compléter ou de décaler ces prévisions avant de clôturer la période.</div></div></div><div class=form-group><label class=col-sm-6>Balance réelle</label><div class=col-sm-6><input type=money class=form-control placeholder=Balance ng-model=realBalance></div></div><div class=form-group><label class=col-sm-6>Écart observé</label><div class="col-sm-6 money" value="realBalance - summedBalance"></div></div><div class=form-group ng-if=error><div class=col-sm-12><div class="alert alert-danger">{{ error }}</div></div></div></div></div><div class=modal-footer><button ng-class=buttons[0].classes ng-disabled="!closingDate || unresolvedCount" ng-click=closePeriod() ng-bind=buttons[0].text class=btn></button> <button ng-class=buttons[1].classes ng-click=buttons[1].click($event) ng-bind=buttons[1].text class=btn></button></div>'),a.put("app/cashflow/recurring-prediction.html","<div class=modal-header><button ng-if=dismissable type=button ng-click=$dismiss() class=close>&times;</button><h4 ng-if=title ng-bind=title class=modal-title></h4></div><div class=modal-body><div class=form-horizontal role=form><div class=form-group><label class=col-sm-3>Périodicité</label><div class=col-sm-3></div></div></div></div><div class=modal-footer><button ng-class=buttons[0].classes ng-disabled=false ng-click=ok() ng-bind=buttons[0].text class=btn></button> <button ng-class=buttons[1].classes ng-click=buttons[1].click($event) ng-bind=buttons[1].text class=btn></button></div>"),a.put("app/indicators/indicator-edit.html",'<div class=modal-header><button type=button ng-click=$dismiss() class=close>&times;</button><h3 class=modal-title><i class="fa fa-edit"></i> {{vm.title}}</h3></div><div class=modal-body><form class=form-horizontal name=vm.form novalidate show-validation><fieldset ng-disabled=vm.readonly><div class=form-group><div class=col-sm-12><input class=form-control placeholder=Nom ng-model=vm.indicator.name name=name required></div></div><div class=form-group><div class=col-sm-8><input class=form-control placeholder=Code ng-model=vm.indicator.code name=code></div><div class=col-sm-4><input class=form-control placeholder=Unité ng-model=vm.indicator.unit name=unit></div></div><div class=form-group ng-if=!config.server.dashboardOnly><div class=col-sm-12><select class=form-control ng-model=vm.indicator.idIndicatorType name=idIndicatorType ng-options="type.idIndicatorType as type.name for type in vm.indicatorTypes"><option value="">Saisie manuelle</option></select></div></div><div class=form-group><label for=indicator-digits class="col-sm-4 control-label">Nombre de décimales</label><div class=col-sm-4><input type=number id=indicator-digits class=form-control ng-model=vm.indicator.decimals name=decimals min=0 max=5></div></div><div class=form-group><label class="col-sm-4 control-label">Limites de l’axe</label><div class=col-sm-4><input type=number id=indicator-limit-low class=form-control placeholder=min. ng-model=vm.indicator.limitMin name=limitMin max={{vm.indicator.limitMax}} required></div><div class=col-sm-4><input type=number id=indicator-limit-high class=form-control placeholder=max. ng-model=vm.indicator.limitMax name=limitMax min={{vm.indicator.limitMin}} required></div></div><div class=form-group><label class="col-sm-4 control-label">Seuils d’alerte</label><div class=col-sm-4><input type=number id=indicator-alert-low class=form-control placeholder=min. ng-model=vm.indicator.alertMin name=alertMin max={{vm.indicator.alertMax}}></div><div class=col-sm-4><input type=number id=indicator-alert-high class=form-control placeholder=max. ng-model=vm.indicator.alertMax name=alertMax min={{vm.indicator.alertMin}}></div></div><div class=form-group><label for=indicator-baseline class="col-sm-4 control-label">Ligne de base du service</label><div class=col-sm-4><input type=number id=indicator-baseline class=form-control ng-model=vm.indicator.baseline name=baseline required></div></div><div class=form-group><div class=col-sm-12><select-users ng-model=vm.indicator.set_users users=vm.users filter="{ idServer: vm.indicator.idServer || undefined }"></select-users></div></div><div class=form-group><div class=col-sm-12><div class=modal-grid><div class="row modal-grid-header-row"><div class="col col-sm-5 modal-grid-col">Date</div><div class="col col-sm-5 modal-grid-col">Objectif</div></div><div class=modal-grid-body><div class="row modal-grid-row" ng-class="$even ? \'even\' : \'odd\'" ng-repeat="objective in vm.indicatorObjectives"><div class="col col-sm-5 modal-grid-col"><period-picker ng-model=objective.billingPeriod></period-picker></div><div class="col col-sm-5 modal-grid-col"><input type=number ng-model=objective.value name=value class=form-control></div><div class="col col-sm-2 modal-grid-col modal-grid-button-col"><button type=button class=pictogram ng-click="vm.deleteObjective(\'cet objectif\', $index)"><span class="glyphicon glyphicon-minus-sign"></span></button></div></div></div><div class="row modal-grid-header-row"><div class="col col-sm-10 modal-grid-col"></div><div class="col col-sm-2 modal-grid-col modal-grid-button-col"><button type=button class=pictogram ng-click=vm.newObjective()><span class="glyphicon glyphicon-plus-sign"></span></button></div></div></div></div></div></fieldset></form></div><div class=modal-footer><button ng-show=!vm.readonly ng-click=vm.save() class="btn btn-primary">OK</button> <button ng-show=!vm.readonly ng-click=vm.cancel() class=btn>Annuler</button> <button ng-show=vm.readonly ng-click=vm.cancel() class=btn>Fermer</button></div>'),a.put("app/indicators/indicators-graph.html",'<div class=grow><div class=grow ng-if=!currentIndicator.indicatorType.chart><div class="indicators-graph grow"><div graphs-line-chart class=grow indicator=currentIndicator row=currentIndicatorRow server=currentServer header-width=headerWidth column-width=columnWidth width={{width}} height={{height}}></div></div></div><div class=grow ng-if=currentIndicator.indicatorType.chart><div class="indicators-graph grow" ng-style="{ \'min-height\': svgHeight }"><div graphs-pie-multiple class=grow indicator=currentIndicator row=currentIndicatorRow server=currentServer header-width=headerWidth column-width=columnWidth width=width height=height></div></div></div></div>'),a.put("app/indicators/indicators.html",'<layout-navbar></layout-navbar><layout-page id=page-indicators><layout-sidebar><form class=btn name=periodForm><div class=input-group ng-class="{ \'has-error\': periodForm.periodCount.$invalid }"><input class=form-control name=periodCount type=number min=2 max=12 ng-change=vm.updatePeriodCount() ng-model=vm.periodCount><label class=input-group-addon>pér.</label></div><period-picker ng-model=vm.state.startingPeriod></period-picker></form><hr><button class=btn ng-click=vm.newIndicator() ng-if="config.user.permissions[\'ind.indicator.insert\']"><i class="fa fa-plus-circle"></i> Nouveau</button> <button class="btn btn-default" ng-click=vm.editIndicator() ng-disabled=!vm.currentIndicator ng-if="config.user.permissions[\'ind.indicator.update\']"><i class="fa fa-edit"></i> Éditer</button> <button class="btn btn-default" ng-click=vm.deleteIndicator(vm.currentIndicator.name) ng-disabled="!vm.currentIndicator || (\n        !vm.currentIndicator.idServer && !config.isMultiServer()\n      )" ng-if="config.user.permissions[\'ind.indicator.delete\']"><i class="fa fa-minus-circle"></i> Supprimer</button> <a class="btn btn-default" ng-if="config.user.permissions[\'ind.indicator.export\']" href="{{vm.grid.exportUrl + \'&idServer=\' + config.currentServerId}}" ng-disabled=!vm.grid.exportUrl target=_blank download><i class="fa fa-file-excel-o"></i> Exporter</a></layout-sidebar><server-sidebar ng-if=config.isMultiServer() default-text="Indicateurs globaux" current-server-id=config.currentServerId servers=vm.servers></server-sidebar><layout-content class=layout-content-light><div class=grid-col-header-bg ng-style="{ width: vm.headerWidth + \'%\' }"></div><div header-splitter width=vm.headerWidth class=grid-col-header-splitter></div><layout-content-header><div class=grid-header-col-header-bg ng-style="{ width: vm.headerWidth + \'%\' }"></div><div class=grid><div class=grid-header-row><div class="grid-header grid-col-header period-count-header" ng-style="{ width: vm.headerWidth + \'%\' }"></div><div class="grid-header grid-header-big" ng-repeat="header in vm.yearHeaders" ng-style="{ width: (100 - vm.headerWidth) * header.width + \'%\' }">{{ header.name }}</div></div><div class=grid-header-row><div class="grid-header grid-col-header" ng-style="{ width: vm.headerWidth + \'%\' }">Indicateur</div><div class=btn-navigate-container><button type=button class=btn-prev-period ng-click="vm.state.startingPeriod=vm.state.startingPeriod-1"><span class="glyphicon glyphicon-chevron-left" aria-hidden=true></span></button></div><div class=grid-header ng-repeat="header in vm.monthHeaders" ng-style=vm.columnStyle>{{ header.name }}</div><div class=btn-navigate-container><button type=button class=btn-next-period ng-click="vm.state.startingPeriod=vm.state.startingPeriod+1"><span class="glyphicon glyphicon-chevron-right" aria-hidden=true></span></button></div></div></div></layout-content-header><layout-content-body><div class=grid><div ng-repeat="indicator in vm.indicatorGrid"><div class=grid-row ng-repeat="indicatorServer in indicator.lastValues" ng-click=vm.selectRow(indicator) ng-show="indicatorServer.server.idServer === config.currentServerId || (!indicator.server && !config.currentServerId)" ng-class="indicator === vm.currentIndicatorRow ? \'current\' : \'\'"><div class=grid-col draggable-grid-header draggable-value=indicator on-drop="vm.reorder(reorderValue, positionValue, position)" draggable-disabled="!config.user.permissions[\'ind.indicator.update\']" ng-style="{ width: vm.headerWidth + \'%\' }"><div class=grid-col-header><div class=indicator-name>{{ indicator.name }} <span ng-if=indicator.indicator.unit>({{ indicator.indicator.unit }})</span></div><div ng-if=!config.currentServerId class=indicator-server-name>{{ indicatorServer.server.name }}</div></div></div><div class="grid-col grid-value" ng-style=vm.columnStyle ng-repeat="value in indicatorServer.periods" ng-click="vm.editValue(indicator, indicatorServer.server, value)"><div class=grid-cell-btns><div ng-if="value.attachmentCount > 0" class="grid-cell-btn fa-file"></div><div ng-if="value.noteCount > 0" class="grid-cell-btn fa-sticky-note-o"></div></div><div class=indicator-grid-value ng-class="value.manual ? \'\' : \'indicator-computed-value\'"><span ng-class="value.alert ? \'indicator-alert\': \'\'" ng-if=!value.graph>{{ value.value | number:indicator.decimals }}</span> <span ng-if=value.graph><i class="fa fa-pie-chart"></i> {{ value.sum | number:indicator.decimals }}</span> <span class=edit ng-if="(value.value === undefined || value.value === null) && !value.graph"><i class="fa fa-edit"></i></span></div></div></div></div></div></layout-content-body><layout-content-footer ng-if=vm.currentIndicator><indicators-graph current-server=config.currentServerId current-indicator=vm.currentIndicator current-indicator-row=vm.currentIndicatorRow header-width=vm.headerWidth column-width=vm.columnWidth></indicators-graph></layout-content-footer></layout-content></layout-page>'),a.put("app/indicators/text-note.html",'<div class=modal-header><button type=button ng-click=vm.close() class=close>&times;</button><h3 class=modal-title><i class="fa fa-edit"></i> Note texte</h3></div><div class=modal-body><textarea class=form-control ng-model=vm.value></textarea></div><div class=modal-footer><button ng-click=vm.save() class="btn btn-primary">OK</button> <button ng-click=vm.cancel() class=btn>Annuler</button></div>'),a.put("app/indicators/value-edit.html",'<div class=modal-header><button type=button ng-click=vm.close() ng-disabled=vm.saving class=close>&times;</button><h3 class=modal-title><i class="fa fa-edit"></i> {{vm.title}}</h3><h3 class=modal-subtitle>Période {{vm.billingPeriod.referenceDate | date: \'MMMM yyyy\' }}</h3></div><div class=modal-body><div class=row><div class=col-sm-6><div class=form-horizontal role=form><div class="form-group light-modal-grid"><div class=col-sm-4><h4>Valeur <span class=unit ng-if=vm.indicator.unit>({{ vm.indicator.unit }})</span></h4></div><div class=col-sm-4><h4>Éditeur</h4></div><div class=col-sm-4><h4>Date</h4></div><div class=col-sm-12><div class=row ng-repeat="value in vm.values"><div class="col-sm-4 col-border-right grid-value"><span ng-if=!vm.computedValue.graph>{{value.value | number:vm.indicator.decimals }}</span> <span ng-if=vm.computedValue.graph>{{ vm.graphSum(value) }}</span> <span ng-if=value.graph><i class="fa fa-pie-chart"></i></span></div><div class="col-sm-4 col-border-right">{{value.creatingUser.login}}</div><div class=col-sm-4 ng-if=value.creatingUser>{{value.createdDate | date:\'dd/MM/yyyy\'}}</div></div></div></div><div class=form-group ng-if="vm.isEditable && !(vm.isComputed) && vm.editingAllowed"><div class=col-sm-8><div class=input-group><input type=number class="value-value form-control" ng-model=vm.inputValue><div class=input-group-addon>{{ vm.indicator.unit }}</div></div></div><div class=col-sm-4><button ng-class="" ng-disabled="vm.saving || (vm.inputValue === null)" ng-click=vm.saveValue() class="btn btn-block btn-primary">Ajouter</button></div></div><div class=form-group ng-if="vm.isEditable && vm.isComputed && vm.editingAllowed"><div class=col-sm-8><div class=input-group><div class=input-group-addon ng-if=vm.computedValue.graph><i class="fa fa-pie-chart"></i></div><div ng-if=!vm.computedValue.graph><input disabled type=number class="value-value form-control" ng-model=vm.computedValue.value></div><div ng-if=vm.computedValue.graph><input disabled type=number class="value-value form-control" value={{vm.graphSum(vm.computedValue)}}></div><div class=input-group-addon ng-if=vm.indicator.unit>{{ vm.indicator.unit }}</div></div></div><div class=col-sm-4><button ng-class="" ng-disabled=vm.saving ng-click=vm.saveValue() class="btn btn-block btn-primary">Valider</button></div></div><div class=form-group ng-if="!vm.isEditable && vm.editingAllowed"><div class=col-sm-8><label>Non éditable sur le serveur central</label></div></div></div></div><div class=col-sm-6><div class=form-horizontal role=form><div class=form-group><div class=col-sm-12><div class=attachment target=_blank ng-click=vm.openAttachment(attachment) ng-repeat="attachment in vm.attachments"><button class="pictogram attachment-delete" ng-click="$event.stopPropagation();vm.deleteAttachment(attachment.file.name, attachment);" ng-if="config.user.permissions[\'ind.indicator.attachment.delete\']"><span class="glyphicon glyphicon-minus-sign"></span></button> <i ng-if=attachment.file class="fa fa-file"></i> <i ng-if=!attachment.file class="fa fa-sticky-note-o"></i><div class=attachment-name><span ng-if=!attachment.file>{{attachment.message && attachment.message.substring && attachment.message.substring(0, 128)}}</span> <span ng-if=attachment.file>{{attachment.file.name}}</span><div class=downloading ng-if="attachment.file && !attachment.file.complete">En cours de synchronisation</div></div></div></div></div><div class=form-group><div class=col-sm-6><button ng-class="" class="btn btn-block btn-primary" ng-click=vm.newTextNote() ng-if="config.user.permissions[\'ind.indicator.attachment\']">Note texte</button></div><div class=col-sm-6><div ngf-drop ngf-select ng-model=vm.files class=dropbox ngf-drag-over-class="\'dragover\'" ngf-multiple=true ngf-allow-dir=true accept=*/* ngf-pattern=*/* ng-if="config.user.permissions[\'ind.indicator.attachment\'] &&\n                config.user.permissions[\'file.upload\']">Fichier</div></div></div></div></div></div></div><div class=modal-footer><button ng-disabled=vm.saving ng-class="" ng-click=vm.close() class=btn>Fermer</button></div>'),a.put("app/login/login.html",'<div class="container container-login"><form class=form-login ng-class="{\'has-error\': vm.error}"><div class=logo></div><h2 class=form-login-heading>Se connecter</h2><div class=form-group ng-class="{\'has-feedback\': vm.error}"><label for=inputLogin class=sr-only>Login</label><input id=inputLogin class=form-control placeholder=Login required autofocus ng-model=vm.login ng-change=vm.clearError()> <span class="glyphicon glyphicon-remove form-control-feedback" aria-hidden=true></span></div><div class=form-group ng-class="{\'has-feedback\': vm.error}"><label for=inputPassword class=sr-only>Mot de passe</label><input type=password id=inputPassword class=form-control placeholder="Mot de passe" ng-model=vm.password ng-change=vm.clearError()> <span class="glyphicon glyphicon-remove form-control-feedback" aria-hidden=true></span></div><button class="btn btn-lg btn-primary btn-block" type=submit ng-disabled=vm.loginDisabled ng-click=vm.doLogin()>Connexion</button></form></div>'),a.put("app/main/alert.html",'<div class="document page-main-alert" ng-class="{\n    new: !sentAlert.status[0].viewed,\n    today: sentAlert.isToday()\n  }"><div class=document-header><h3><i class="fa fa-warning"></i> <a href=# ng-click=open(sentAlert)>{{ sentAlert.alert.title }}</a></h3><div ng-if=config.isMultiServer() class=alert-server>{{ sentAlert.server.name }}</div><div class=alert-date>Envoyé le {{ sentAlert.sentDate | date: \'longDate\' }}</div><div class="alert-date alert-date-expires">Échéance le {{ sentAlert.expiresDate | date: \'longDate\' }}</div></div><div class="document-content alert-content"><div ng-if=sentAlert.emails.length>Envoyé à <span ng-repeat="email in sentAlert.emails"><span class=alert-email ng-if=email.user>{{email.user.login}}</span> <span class=alert-email ng-if=email.email>({{email.email}})</span>{{$last ? \'\' : \', \'}}</span></div><div class=alert-description ng-bind-html=sentAlert.description></div></div></div>'),a.put("app/main/main.html","<layout-navbar></layout-navbar><layout-page class=page-main><layout-content><layout-content-header ng-if=config.isMultiServer()><div class=row><div class=\"col-sm-6 page-main-header\">Alertes</div><div class=\"col-sm-6 page-main-header\">Exploitations</div></div></layout-content-header><layout-content-body class=padding><div class=row><div ng-class=\"config.isMultiServer() ? 'col-sm-6' : 'col-sm-12'\"><div class=row><div ng-class=\"config.isMultiServer() ? 'col-md-12 col-lg-6' : 'col-sm-6 col-md-4 col-lg-3'\" ng-repeat=\"sentAlert in vm.sentAlerts | currentAlert | orderBy:'expiresDate'\"><alert on-open=vm.openAlert(sentAlert) sent-alert=sentAlert></alert></div></div><div class=row><h2>Alertes passées</h2></div><div class=row><div ng-class=\"config.isMultiServer() ? 'col-md-12 col-lg-6' : 'col-sm-6 col-md-4 col-lg-3'\" ng-repeat=\"sentAlert in vm.sentAlerts | expiredAlert | orderBy:'-expiresDate'\"><alert on-open=vm.openAlert(sentAlert) sent-alert=sentAlert></alert></div></div></div><div class=col-sm-6 ng-if=config.isMultiServer()><div class=row><div ng-class=\"config.isMultiServer() ? 'col-md-12 col-lg-6' : 'col-sm-6 col-md-4 col-lg-3'\" ng-repeat=\"server in vm.servers\"><div class=\"document page-main-server\"><div class=document-header><div class=logo ng-if=server.logoUrl() style=\"background-image: url({{ server.logoUrl() }})\"></div><h3><i class=\"fa fa-building\"></i> <a href=# ng-click=vm.openIndicator(server)>{{ server.name }}</a></h3><div>{{ server.location }}</div></div><div class=\"document-content server-content\"><div ng-if=!server.dashboardOnly><ng-pluralize count=server.customers when=\"{'0': 'Aucun abonné',\n                        'one': '1 abonné',\n                        'other': '{} abonnés'}\"></ng-pluralize></div><div ng-if=server.synchronization.lastSync>Mis à jour le {{ server.synchronization.lastSync | date: 'longDate' }}</div></div></div></div></div></div></div></layout-content-body></layout-content></layout-page>"),a.put("app/setup/backup/backup.html",'<layout-navbar></layout-navbar><layout-page><layout-sidebar><div class=btn-group-vertical><button class="btn btn-default" ng-click=vm.newBackup()>Nouvelle sauvegarde</button> <button class="btn btn-default" ng-click=vm.deleteBackup() ng-disabled=!vm.currentRow>Supprimer la sauvegarde</button></div></layout-sidebar><layout-content><layout-content-header><div class=grid><div class=grid-header-row><div class="col-sm-3 grid-header">Type</div><div class="col-sm-1 grid-header">Lun.</div><div class="col-sm-1 grid-header">Mar.</div><div class="col-sm-1 grid-header">Mer.</div><div class="col-sm-1 grid-header">Jeu.</div><div class="col-sm-1 grid-header">Ven.</div><div class="col-sm-1 grid-header">Sam.</div><div class="col-sm-1 grid-header">Dim.</div><div class="col-sm-2 grid-header">Heure</div></div></div></layout-content-header><layout-content-body><div class=grid><div class=grid-row ng-repeat="backup in vm.backups" ng-click=vm.selectRow(backup) ng-class="backup === vm.currentRow ? \'current\' : \'\'" ng-drag=true><div class=col-sm-3><select class=form-control ng-options="type.idBackupType as type.description for type in vm.backupTypes" ng-model=backup.idBackupType ng-change=vm.changed(backup)></select></div><div class="col-sm-1 grid-cell-check"><checkbox larger ng-model=backup.wd1 ng-change=vm.changed(backup) class=btn-primary></checkbox></div><div class="col-sm-1 grid-cell-check"><checkbox larger ng-model=backup.wd2 ng-change=vm.changed(backup) class=btn-primary></checkbox></div><div class="col-sm-1 grid-cell-check"><checkbox larger ng-model=backup.wd3 ng-change=vm.changed(backup) class=btn-primary></checkbox></div><div class="col-sm-1 grid-cell-check"><checkbox larger ng-model=backup.wd4 ng-change=vm.changed(backup) class=btn-primary></checkbox></div><div class="col-sm-1 grid-cell-check"><checkbox larger ng-model=backup.wd5 ng-change=vm.changed(backup) class=btn-primary></checkbox></div><div class="col-sm-1 grid-cell-check"><checkbox larger ng-model=backup.wd6 ng-change=vm.changed(backup) class=btn-primary></checkbox></div><div class="col-sm-1 grid-cell-check"><checkbox larger ng-model=backup.wd7 ng-change=vm.changed(backup) class=btn-primary></checkbox></div><div class=col-sm-2><timepicker ng-model=backup.time ng-change=vm.changed(backup) show-meridian=false minute-step=15></timepicker></div></div></div></layout-content-body></layout-content></layout-page>'),a.put("app/setup/domains/domain-edit.html",'<div class=modal-header><button type=button ng-click=$dismiss() class=close>&times;</button><h3 class=modal-title>{{vm.title}}</h3></div><div class=modal-body><form name=vm.form class=form-horizontal novalidate show-validation><div class=form-group><label class="col-sm-3 control-label">Nom</label><div class=col-sm-9><input class=form-control name=name ng-model=vm.document.name placeholder="Nom du domaine" required></div></div></form></div><div class=modal-footer><button ng-click=vm.save() class="btn btn-primary">OK</button> <button ng-click=vm.cancel() class=btn>Annuler</button></div>'),a.put("app/setup/domains/domain.component.html",'<div class="domain document" ng-class="{ selected: $ctrl.isSelected }"><div class=document-header><h3><i class="fa fa-diamond"></i> {{ $ctrl.domain.name }}</h3></div><div class=document-content><span ng-repeat="server in $ctrl.domain.servers"><span class=document-group>{{server.name}}</span>{{$last ? \'\' : \', \'}}</span></div></div>'),a.put("app/setup/domains/domains.html",'<layout-navbar></layout-navbar><layout-page id=page-setup-domains class=page-setup><layout-sidebar ng-show="\n    config.user.permissions[\'prm.domains.insert\'] ||\n    config.user.permissions[\'prm.domains.update\'] ||\n    config.user.permissions[\'prm.domains.delete\']"><button class=btn ng-click=vm.newDomain() ng-if="config.user.permissions[\'prm.domains.insert\']"><i class="fa fa-plus-circle"></i> Nouveau</button> <button class="btn btn-default" ng-click=vm.editDomain() ng-disabled=!vm.selectedDomain ng-if="config.user.permissions[\'prm.domains.update\']"><i class="fa fa-edit"></i> Éditer</button> <button class="btn btn-default" ng-click=vm.deleteDomain(vm.selectedDomain.name) ng-disabled=!vm.selectedDomain ng-if="config.user.permissions[\'prm.domains.delete\']"><i class="fa fa-minus-circle"></i> Supprimer</button></layout-sidebar><layout-content><layout-content-body class=padding><div class=row><div class="col-sm-6 col-md-4 col-lg-3" ng-repeat="domain in vm.domains"><domain domain=domain is-selected="vm.selectedDomain === domain" ng-dblclick=vm.editDomain(domain) ng-click="vm.selectedDomain = domain"></domain></div></div></layout-content-body></layout-content></layout-page>'),a.put("app/setup/groups/group-edit.html",'<div class=modal-header><button type=button ng-click=$dismiss() class=close>&times;</button><h3 class=modal-title>{{vm.title}}</h3></div><div class=modal-body><form name=vm.form class=form-horizontal novalidate show-validation><div class=form-group ng-if=config.isMultiServer()><div class=col-sm-12><select class=form-control ng-disabled=!vm.isNew required ng-model=vm.document.idServer ng-options="server.idServer as server.name for server in vm.servers"></select></div></div><div class=form-group><label class="col-sm-4 control-label">Nom</label><div class=col-sm-8><input class=form-control name=name ng-model=vm.document.name placeholder=Nom required></div></div><div class=form-group><label class="col-sm-4 control-label">Administrateur (toutes les permissions)</label><div class=col-sm-8><label><input type=checkbox ng-model=vm.document.isAdmin> {{ permission.description }}</label></div></div><fieldset class=group-permissions-fieldset ng-if=!vm.document.isAdmin><div class=form-group><label class="col-sm-4 control-label">Sélection</label><div class=col-sm-4><button type=button class="btn btn-block btn-info" ng-click=vm.selectAll()>Sélectionner tout</button></div><div class=col-sm-4><button type=button class="btn btn-block btn-info" ng-click=vm.unselectAll()>Désélectionner tout</button></div></div><div class=form-group><div class=col-sm-12><h4>Permissions</h4></div></div><div class=form-group><div class=col-sm-12 ng-repeat="permission in vm.permissions\n          | filter: {\n            idServer: vm.document.idServer,\n            webGroup: appConfig.server.dashboardOnly || undefined\n          } : true"><label><input type=checkbox ng-model=vm.document.set_permissions[permission.idPermission]> {{ permission.description }}</label></div></div></fieldset></form></div><div class=modal-footer><button ng-click=vm.save() class="btn btn-primary">OK</button> <button ng-click=vm.cancel() class=btn>Annuler</button></div>'),
a.put("app/setup/groups/groups.html",'<layout-navbar></layout-navbar><layout-page id=page-setup-groups class=page-setup><layout-sidebar ng-show="\n    config.user.permissions[\'prm.group.insert\'] ||\n    config.user.permissions[\'prm.group.update\'] ||\n    config.user.permissions[\'prm.group.delete\']"><button class=btn ng-click=vm.newGroup() ng-if="config.user.permissions[\'prm.group.insert\']"><i class="fa fa-plus-circle"></i> Nouveau</button> <button class="btn btn-default" ng-click=vm.editGroup() ng-disabled=!vm.selectedGroup ng-if="config.user.permissions[\'prm.group.update\']"><i class="fa fa-edit"></i> Éditer</button> <button class="btn btn-default" ng-click=vm.deleteGroup(vm.selectedGroup.name) ng-disabled="!vm.selectedGroup || vm.selectedGroup.isAdmin" ng-if="config.user.permissions[\'prm.group.delete\']"><i class="fa fa-minus-circle"></i> Supprimer</button></layout-sidebar><server-sidebar ng-if=config.isMultiServer() default-text="Tous les serveurs" current-server-id=config.currentServerId servers=vm.servers></server-sidebar><layout-content><layout-content-body class=padding><div class=row><div class="col-sm-6 col-md-4 col-lg-3" ng-repeat="group in vm.groups | filter: { idServer: config.currentServerId || undefined } : true"><div class="group document" ng-class="{ selected: vm.selectedGroup === group }" ng-dblclick=vm.editGroup(group) ng-click="vm.selectedGroup = group"><div class=document-header><h3><i class="fa fa-group"></i> {{group.name}}</h3><div class=document-server>{{group.server.name}}</div></div></div></div></div></layout-content-body></layout-content></layout-page>'),a.put("app/setup/servers/server-edit.html",'<div class=modal-header><button type=button ng-click=$dismiss() class=close>&times;</button><h3 class=modal-title>{{vm.title}}</h3></div><div class=modal-body><form name=vm.form class=form-horizontal novalidate show-validation><div class=form-group><label class="col-sm-3 control-label">Nom</label><div class=col-sm-9><input maxlength=200 class=form-control name=name ng-model=vm.document.name placeholder=Nom required></div></div><div class=form-group><label class="col-sm-3 control-label">Identifiant</label><div class=col-sm-9><input maxlength=100 ng-pattern=^\\w+$ class=form-control name=identifier ng-model=vm.document.identifier placeholder="Identifiant de l\'exploitation (sans espace ni ponctuation)" required></div></div><div class=form-group ng-if="\n      config.user.permissions[\'prm.domains.set_servers\'] &&\n      vm.document.idServer !== vm.thisServer.idServer\n    "><label class="col-sm-3 control-label">Domaine de l\'exploitation</label><div class=col-sm-9><ui-select ng-model=vm.document.idDomain reset-search-input=false title="Domaine de l\'exploitation"><ui-select-match placeholder=Domaine>{{$select.selected.name}}</ui-select-match><ui-select-choices repeat="domain.idDomain as domain in vm.domains"><div ng-bind-html="domain.name | highlight: $select.search"></div></ui-select-choices></ui-select></div></div><div class=form-group><label class="col-sm-3 control-label">Localisation</label><div class=col-sm-9><input class=form-control name=location ng-model=vm.document.location maxlength=500 placeholder="Localisation de l’exploitation"></div></div><div class=form-group><label class="col-sm-3 control-label">Logo</label><div class=col-sm-9><image-upload ng-model=vm.document.idFile value=vm.document.logoUrl() width=160 height=160></image-upload></div></div></form></div><div class=modal-footer><button ng-click=vm.save() class="btn btn-primary">OK</button> <button ng-click=vm.cancel() class=btn>Annuler</button></div>'),a.put("app/setup/servers/servers.html",'<layout-navbar></layout-navbar><layout-page id=page-setup-servers class=page-setup><layout-sidebar ng-show="\n    config.user.permissions[\'prm.server.insert\'] ||\n    config.user.permissions[\'prm.server.update\'] ||\n    config.user.permissions[\'prm.server.delete\']"><button class="btn btn-default" ng-click=vm.newSync() ng-if="config.user.permissions[\'prm.server.insert\']"><i class="fa fa-key"></i> Nouvelle clé</button> <button class="btn btn-default" ng-click=vm.newServer() ng-if="config.user.permissions[\'prm.server.insert\']"><i class="fa fa-plus-circle"></i><div>Nouvelle exploitation</div><div><small>(sans synchronisation)</small></div></button> <button class="btn btn-default" ng-click=vm.editServer() ng-disabled=!vm.selectedServer ng-if="config.user.permissions[\'prm.server.update\']"><i class="fa fa-server"></i> Éditer le serveur</button> <button class="btn btn-default" ng-click=vm.deleteSync() ng-disabled=!vm.selectedSynchronization ng-if="config.user.permissions[\'prm.server.delete\']"><i class="fa fa-minus-circle"></i> Supprimer la clé</button></layout-sidebar><layout-content><layout-content-body class=padding><h2 ng-if=vm.servers.length>Serveurs synchronisés</h2><div class=row><div class="col-sm-6 col-md-4 col-lg-3" ng-repeat="server in vm.servers"><div class="server document" ng-class="{ selected: vm.selectedServer.idServer === server.idServer }" ng-dblclick=vm.editServer(server) ng-click=vm.select(server)><div class=document-header><div class=logo ng-if=server.logoUrl() style="background-image: url({{ server.logoUrl() }})"></div><h3><i class="fa fa-server"></i> {{server.name}}</h3><div class=document-server>{{server.location}}</div></div><div class=document-content><div><i class="fa fa-user"></i><ng-pluralize count=server.customers when="{\'0\': \'Aucun abonné\',\n                    \'one\': \'1 abonné\',\n                    \'other\': \'{} abonnés\'}"></ng-pluralize></div><div ng-if=server.synchronization.lastSync><i class="fa fa-refresh"></i> Mis à jour le {{ server.synchronization.lastSync | date: \'longDate\' }}</div><div ng-if=server.synchronization><i class="fa fa-key"></i> <span class=psk>{{server.synchronization.psk}}</span></div></div></div></div></div><h2 ng-if=vm.synchronizations.length>Clés en attente</h2><div class=row><div class="col-sm-6 col-md-4 col-lg-3" ng-repeat="synchronization in vm.synchronizations"><div class="synchronization document" ng-repeat="synchronization in vm.synchronizations" ng-class="{ selected: vm.selectedSynchronization.idSynchronization === synchronization.idSynchronization }" ng-click=vm.select(synchronization)><div class=document-header><i class="fa fa-key"></i><div class=psk>{{synchronization.psk}}</div></div></div></div></div></layout-content-body></layout-content></layout-page>'),a.put("app/setup/sync/sync.html",'<layout-navbar></layout-navbar><layout-page id=page-setup-sync class=page-setup><layout-content><layout-content-body class="padding max-width"><div class=document><div class=document-header><h3><i class="fa fa-server"></i> Configuration du serveur</h3></div><div class=document-content><form name=vm.serverForm class=form-horizontal novalidate show-validation><div class=form-group><label class="col-sm-3 control-label">Nom</label><div class=col-sm-9><input class=form-control name=name ng-model=vm.me.name placeholder=Nom required></div></div><div class=form-group><label class="col-sm-3 control-label">Localisation</label><div class=col-sm-9><input class=form-control name=location ng-model=vm.me.location placeholder="Localisation de l’exploitation"></div></div><div class=form-group><label class="col-sm-3 control-label">Logo</label><div class=col-sm-9><image-upload ng-model=vm.me.idFile value=vm.me.logoUrl() width=160 height=160></image-upload></div></div><div class=form-group><div class="col-sm-12 text-right"><button ng-click=vm.saveServer() class="btn btn-primary" ng-disabled="vm.savingSync || !config.user.permissions[\'prm.server.update\']">Enregistrer</button></div></div><div class=form-group ng-if=vm.savingServerStatus><div uib-alert class=col-sm-12 class="{{vm.savingServerStatus.success ? \'alert-success\' : \'alert-warning\'}}" close="vm.savingServerStatus = null">{{vm.savingServerStatus.success ? \'Enregistré avec succès !\' : vm.savingServerStatus.message }}</div></div></form></div></div><div class=document ng-repeat="synchronization in vm.synchronizations"><div class=document-header><h3><i class="fa fa-server"></i> Synchronisation</h3></div><div class=document-content><form name=vm.syncForm class=form-horizontal novalidate show-validation><div class=form-group><label class="col-sm-3 control-label">URL</label><div class=col-sm-9><input class=form-control name=name ng-model=synchronization.pushUrl placeholder=https://address/sync required></div></div><div class=form-group><label class="col-sm-3 control-label">Clé</label><div class=col-sm-9><input class=form-control name=psk ng-model=synchronization.psk placeholder=Clé required></div></div><div class=form-group><label class="col-sm-3 control-label">Fréquence de synchronisation</label><div class=col-sm-9><div class=input-group><input type=number class=form-control name=frequency ng-model=synchronization.pushFrequency placeholder=60 required><label class=input-group-addon>secondes</label></div></div></div><div class=form-group><div class="col-sm-12 text-right"><button ng-click=vm.testSync(synchronization) class=btn ng-disabled=vm.savingServer ng-show="config.user.permissions[\'prm.server.insert\']">Tester</button> <button ng-click=vm.saveSync(synchronization) class="btn btn-primary" ng-disabled="vm.savingServer ||\n'+"                    !config.user.permissions['prm.server.update']\">Enregistrer</button></div></div><div class=form-group ng-if=vm.testResult><div uib-alert class=\"col-sm-12 alert {{vm.testResult.success ? 'alert-success' : 'alert-warning'}}\" close=\"vm.testResult = null\">{{vm.testResult.success ? 'Test de synchronisation réalisé avec succès !' : vm.testResult.message }}</div></div><div class=form-group ng-if=vm.savingSyncStatus><div uib-alert class=\"col-sm-12 alert {{vm.savingServerStatus.success ? 'alert-success' : 'alert-warning'}}\" close=\"vm.savingSyncStatus=null\">{{vm.savingSyncStatus.success ? 'Enregistré avec succès !' : vm.savingSyncStatus.message }}</div></div></form></div></div></layout-content-body></layout-content></layout-page>"),a.put("app/setup/users/user-edit.html",'<div class=modal-header><button type=button ng-click=$dismiss() class=close>&times;</button><h3 class=modal-title>{{vm.title}}</h3></div><div class=modal-body><form name=vm.form class=form-horizontal novalidate show-validation><fieldset ng-disabled=vm.readonly><div class=form-group ng-if="config.isMultiServer() && vm.isNew"><div class=col-sm-12><select class=form-control required ng-model=vm.document.idServer ng-options="server.idServer as server.name for server in vm.servers"></select></div></div><div class=form-group><label class="col-sm-3 control-label">Identifiant</label><div class=col-sm-9><input class=form-control name=login ng-model=vm.document.login placeholder=Login required></div></div><div class=form-group><label class="col-sm-3 control-label">Prénom</label><div class=col-sm-9><input class=form-control name=firstName ng-model=vm.document.firstName placeholder=Prénom required></div></div><div class=form-group><label class="col-sm-3 control-label">Nom</label><div class=col-sm-9><input class=form-control name=lastName ng-model=vm.document.lastName placeholder=Nom required></div></div><div class=form-group><label class="col-sm-3 control-label">Mot de passe</label><div class=col-sm-9><input type=password class=form-control name=password ng-model=vm.document.password placeholder="Mot de passe" ng-required=vm.isNew></div></div><div class=form-group><label class="col-sm-3 control-label">Confirmer</label><div class=col-sm-9><input type=password class=form-control name=passwordConfirm ng-model=vm.document.passwordConfirm placeholder="Mot de passe (confirmation)" ng-required=vm.isNew compare-to=vm.document.password></div></div><div class=form-group ng-if=!vm.document.isLocked><label class="col-sm-3 control-label"></label><div class=col-sm-9><label><input type=checkbox ng-model=vm.document.isValid> Utilisateur activé</label></div></div><div class=form-group><label class="col-sm-3 control-label">Domicile</label><div class=col-sm-3><input class=form-control name=phone1 ng-model=vm.document.phone1 placeholder=Téléphone></div><label class="col-sm-3 control-label">Bureau</label><div class=col-sm-3><input class=form-control name=phone2 ng-model=vm.document.phone2 placeholder=Téléphone></div></div><div class=form-group><label class="col-sm-3 control-label">Portable</label><div class=col-sm-3><input class=form-control name=phone3 ng-model=vm.document.phone3 placeholder=Téléphone></div><label class="col-sm-3 control-label">Autre</label><div class=col-sm-3><input class=form-control name=phone4 ng-model=vm.document.phone4 placeholder=Téléphone></div></div><div class=form-group><label class="col-sm-3 control-label">Courriel</label><div class=col-sm-9><input class=form-control name=email ng-model=vm.document.email placeholder=Courriels></div></div><div class=form-group ng-if="\r\n        vm.document.idServer === vm.thisServer.idServer &&\r\n        vm.domains.length > 1 &&\r\n        !vm.document.isLocked\r\n      "><div class=col-sm-12><ui-select multiple ng-required ng-model=vm.document.set_domains reset-search-input=false title="Accès aux domaines"><ui-select-match placeholder=Domains>{{$item.name}}</ui-select-match><ui-select-choices repeat="domain.idDomain as domain in vm.domains"><div ng-bind-html="domain.name | highlight: $select.search"></div></ui-select-choices></ui-select></div></div><fieldset class=user-groups-fieldset ng-if=!vm.document.isLocked><div class=form-group><div class=col-sm-12><h4>Groupes</h4></div></div><div class=form-group><div class=col-sm-6 ng-repeat="group in vm.groups | filter: { idServer: vm.document.idServer } : true"><label><input type=checkbox ng-disabled="group.isProtected && !config.user.permissions[\'prm.group.protected\']" ng-model=vm.document.set_groups[group.idGroup]> {{ group.name }}</label></div></div></fieldset></fieldset></form></div><div class=modal-footer><button ng-if=!vm.readonly ng-click=vm.save() class="btn btn-primary">OK</button> <button ng-if=vm.readonly ng-click=vm.cancel() class="btn btn-primary">Fermer</button> <button ng-if=!vm.readonly ng-click=vm.cancel() class=btn>Annuler</button></div>'),a.put("app/setup/users/user.component.html",'<div class="user document" ng-class="{\n    selected: $ctrl.isSelected,\n    inactive: !$ctrl.user.isValid,\n    \'server-user\': $ctrl.isServerUser()\n  }"><div class=document-header><h3><i class="fa fa-user-circle" ng-if=$ctrl.isServerUser()></i> <i class="fa fa-user" ng-if=!$ctrl.isServerUser()></i> {{$ctrl.user.login}}</h3><div class=document-server ng-if=!$ctrl.isServerUser()>{{$ctrl.user.server.name}}</div><div class=document-domains ng-if=$ctrl.isServerUser()><span ng-repeat="domain in $ctrl.user.domains"><i class="fa fa-diamond"></i> <span class=domain>{{domain.name}}</span>{{$last ? \'\' : \', \'}}</span></div></div><div class=document-content><div class=document-name>{{$ctrl.user.firstName}} {{$ctrl.user.lastName}}</div><div ng-show=!$ctrl.user.isValid>Utilisateur désactivé</div><div class=document-groups><span ng-repeat="group in $ctrl.user.groups"><span class=document-group>{{group.name}}</span>{{$last ? \'\' : \', \'}}</span></div></div></div>'),a.put("app/setup/users/users.html",'<layout-navbar></layout-navbar><layout-page id=page-setup-users class=page-setup><layout-sidebar ng-show="\n    config.user.permissions[\'prm.create_user\'] ||\n    config.user.permissions[\'prm.edit_user\'] ||\n    config.user.permissions[\'prm.delete_user\']"><button class=btn ng-click=vm.newUser() ng-if="config.user.permissions[\'prm.create_user\']"><i class="fa fa-plus-circle"></i> Nouveau</button> <button class="btn btn-default" ng-click=vm.editUser() ng-disabled=!vm.selectedUser ng-if="config.user.permissions[\'prm.edit_user\']"><i class="fa fa-edit"></i> Éditer</button> <button class="btn btn-default" ng-click=vm.deleteUser(vm.selectedUser.login) ng-disabled="!vm.selectedUser || vm.selectedUser.isLocked" ng-if="config.user.permissions[\'prm.delete_user\']"><i class="fa fa-minus-circle"></i> Supprimer</button></layout-sidebar><server-sidebar ng-if=config.isMultiServer() default-text="Tous les serveurs" current-server-id=config.currentServerId servers=vm.servers></server-sidebar><layout-content><layout-content-body class=padding><div class=row><div class="col-sm-6 col-md-4 col-lg-3" ng-repeat="user in vm.users\n            | filter: { idServer: config.currentServerId || undefined } : true"><user user=user is-selected="vm.selectedUser === user" ng-dblclick=vm.editUser(user) ng-click="vm.selectedUser = user"></user></div></div></layout-content-body></layout-content></layout-page>'),a.put("components/dateselect/dateselect-popup.html",'<ul class=dateselect-dropdown style="display: block" ng-keydown=keydown($event)><li><div datepicker ng-change=dateSelection() ng-model=date min-date=minDate max-date=maxDate></div></li><li class=dateselect-button-panel><span class=btn-group><button type=button class="btn btn-sm btn-info" ng-click="select(\'today\')">Aujourd’hui</button> <button type=button class="btn btn-sm btn-danger" ng-click=select(null)>Effacer</button></span> <button type=button class="btn btn-sm btn-success pull-right" ng-click=close()>Fermer</button></li></ul>'),a.put("components/dateselect/dateselect.html","<div class=dateselect-container><div ng-transclude></div><a class=dateselect-icon href=# ng-click=open()></a><div dateselect-popup=html></div></div>"),a.put("components/graphs/line/chart.html",'<div class="indicator-header-overlay line-graph" ng-style="{ width: headerWidth + \'%\' }"><div class=indicator-name-header>{{indicator.name + (indicator.unit ? \' (\' + indicator.unit + \')\' : \'\' )}}</div><div class=indicator-header-server ng-repeat="indicatorServer in row.lastValues | serverFilter : currentServer"><div class=indicator-color-header ng-style="{ background: indicatorServer.color }"></div>{{indicatorServer.server.name}}</div></div><svg><g><g class=indicators-graph-header><line ng-attr-x1="{{0.9 * headerX() ||0}}" ng-attr-x2={{headerX()||0}} ng-attr-y1={{pointCoordY(indicator.limitMax)}} ng-attr-y2={{pointCoordY(indicator.limitMax)}} stroke=#fff stroke-width=2></line><text ng-attr-x="{{0.9 * headerX() - 4||0}}" ng-attr-y={{20}} text-anchor=end>{{indicator.limitMax}}</text><line ng-attr-x1="{{0.9 * headerX()||0}}" ng-attr-x2={{headerX()||0}} ng-attr-y1={{pointCoordY(indicator.limitMin)}} ng-attr-y2={{pointCoordY(indicator.limitMin)}} stroke=#fff stroke-width=2></line><text ng-attr-x="{{0.9 * headerX() - 4||0}}" ng-attr-y="{{height - 10}}" text-anchor=end>{{indicator.limitMin}}</text><line ng-attr-x1="{{0.95 * headerX()||0}}" ng-attr-x2={{headerX()||0}} ng-attr-y1={{pointCoordY(indicator.alertMax)}} ng-attr-y2={{pointCoordY(indicator.alertMax)}} stroke=#fff stroke-width=2></line><text ng-attr-x="{{0.95 * headerX() - 4||0}}" ng-attr-y={{pointCoordY(indicator.alertMax)}} text-anchor=end>{{indicator.alertMax}}</text><line ng-attr-x1="{{0.95 * headerX()||0}}" ng-attr-x2={{headerX()||0}} ng-attr-y1={{pointCoordY(indicator.alertMin)}} ng-attr-y2={{pointCoordY(indicator.alertMin)}} stroke=#fff stroke-width=2></line><text ng-attr-x="{{0.95 * headerX() - 4||0}}" ng-attr-y={{pointCoordY(indicator.alertMin)}} text-anchor=end>{{indicator.alertMin}}</text><line ng-attr-x1="{{0.95 * headerX()||0}}" ng-attr-x2={{headerX()||0}} ng-attr-y1={{pointCoordY(indicator.baseline)}} ng-attr-y2={{pointCoordY(indicator.baseline)}} stroke=#fff stroke-width=2></line><text ng-attr-x="{{0.95 * headerX() - 4||0}}" ng-attr-y={{pointCoordY(indicator.baseline)}} text-anchor=end>{{indicator.baseline}}</text></g><g ng-attr-transform="{{\'translate(\' + (headerX()||0) + \', 0)\'}}"><rect class="indicator-limits indicators-graph-above" x=0 y=0 ng-attr-width={{width-(headerX()||0)}} ng-attr-height={{pointCoordY(indicator.alertMax)}} ng-if="indicator.alertMax !== null"></rect><rect class="indicator-limits indicators-limits-below" x=0 ng-attr-y={{pointCoordY(indicator.alertMin)}} ng-attr-width={{width-(headerX()||0)}} ng-attr-height="{{height - pointCoordY(indicator.alertMin)}}" ng-if="indicator.alertMin !== null"></rect><line class="indicator-limits indicators-graph-above" x1=0 ng-attr-y1={{pointCoordY(indicator.alertMax)||0}} ng-attr-x2={{width-(headerX()||0)}} ng-attr-y2={{pointCoordY(indicator.alertMax)||0}} ng-if="indicator.alertMax !== null"></line><line class="indicator-limits indicators-limits-below" x1=0 ng-attr-y1={{pointCoordY(indicator.alertMin)||0}} ng-attr-x2={{width-(headerX()||0)}} ng-attr-y2={{pointCoordY(indicator.alertMin)||0}} ng-if="indicator.alertMin !== null"></line><line class=indicators-graph-baseline x1=0 ng-attr-y1={{pointCoordY(indicator.limitMin)}} ng-attr-x2={{width-(headerX()||0)}} ng-attr-y2={{pointCoordY(indicator.limitMin)}} stroke-width=2></line><line class=indicators-graph-baseline x1=0 ng-attr-y1={{pointCoordY(indicator.limitMax)}} ng-attr-x2={{width-(headerX()||0)}} ng-attr-y2={{pointCoordY(indicator.limitMax)}} stroke-width=2></line><line class=indicators-graph-baseline x1=0 ng-attr-y1={{pointCoordY(indicator.baseline)}} ng-attr-x2={{width-(headerX()||0)}} ng-attr-y2={{pointCoordY(indicator.baseline)}} stroke-width=2></line><g ng-repeat="indicatorServer in row.lastValues | serverFilter : currentServer"><g ng-repeat="(key, value) in indicatorServer.periods" ng-attr-transform="{{\'translate(\' + (($index + 0.5)*columnX()||0) + \', 0)\'}}"><circle cx=0 ng-attr-cy={{pointCoordY(value.value)}} r=4 class=indicators-graph-circle ng-if=isFinite(value.value) ng-attr-fill={{indicatorServer.color}} ng-class="value.alert ? \'indicator-alert\': \'\'"></circle><circle cx=0 ng-attr-cy={{pointCoordY(value.value)}} r=8 class="indicators-graph-circle alert-surround" fill=none stroke-width=1 ng-if="isFinite(value.value) && value.alert"></circle><line ng-attr-x1={{0}} ng-attr-x2={{columnX()}} ng-attr-y1={{pointCoordY(value.value)}} ng-attr-y2="{{pointCoordY( indicatorServer.periods[+key+1].value)}}" class=indicators-graph-line ng-class="value.alert && indicatorServer.periods[+key+1].alert ? \'indicator-alert\': \'\'" stroke-width=3 ng-attr-stroke={{indicatorServer.color}} ng-if="isFinite(value.value) && isFinite( indicatorServer.periods[+key+1].value)"></line></g></g><g ng-repeat="(key, value) in row.objectives" ng-attr-transform="{{\'translate(\' + (($index)*columnX()||0) + \', 0)\'}}"><line ng-attr-x1={{0}} ng-attr-x2={{columnX()}} ng-attr-y1={{pointCoordY(value.value)}} ng-attr-y2={{pointCoordY(value.value)}} class=indicators-graph-objective ng-class="{\'indicators-graph-computed\': value.computed}" stroke-width=2 ng-if=isFinite(value.value)></line><text ng-attr-x={{0}} ng-attr-y="{{pointCoordY(value.value) - 4}}" class=indicators-graph-objective ng-class="{\'indicators-graph-computed\': value.computed}" ng-if=isFinite(value.value)>{{value.value | number:indicator.decimals }}</text></g></g></g></svg>'),a.put("components/graphs/pie/multiple.html",'<div class=indicator-header-overlay ng-style="{ width: headerWidth + \'%\' }"><div class=indicator-name-header>{{indicator.name + (indicator.unit ? \' (\' + indicator.unit + \')\' : \'\' )}}</div><button type=button class="btn btn-block indicator-header-button" ng-repeat="indicatorServer in values" ng-class="indicatorServer.server.idServer === server ? \'active\' : \'inactive\'" ng-click=setServer(indicatorServer.server) ng-style="{ borderColor: indicatorServer.color, backgroundColor:  indicatorServer.color }">{{indicatorServer.server.name}}</button></div><svg><g><g ng-attr-transform="{{\'translate(\' + (headerX()||0) + \', 0)\'}}"><g ng-repeat="indicatorServer in values | filter: { server: { idServer: server} } : true"><g ng-repeat="(key, value) in indicatorServer.periods" ng-attr-transform="translate({{$index * columnX()||0}}, 0)"><g graphs-pie-single value=value.graph width="{{ columnX() }}"></g></g></g></g></g></svg>'),a.put("components/graphs/pie/single.html",'<svg><g><g ng-attr-transform="translate({{pieWidth / 2}}, {{pieWidth / 2}})"><g ng-repeat="slice in graph"><path ng-if=slice.value ng-attr-d={{slice.path}} ng-attr-fill={{slice.color}} stroke=#fff stroke-width=2 stroke-linejoin=round></path><text ng-if=slice.value ng-attr-x="{{slice.mx || 0}}" ng-attr-y="{{6 + slice.my || 0}}" text-anchor="{{ slice.anchor }}" fill=#fff font-size=10.5>{{+slice.value | number:currentIndicator.decimals}}</text></g></g><g ng-repeat="slice in graph" ng-attr-transform="translate(0, {{+pieWidth + ($index*16)}})" ng-attr-clip-path=url({{loc}}#clip-legend-{{$index}})><clippath ng-attr-id=clip-legend-{{$index}}><rect x=0 y=-12 ng-attr-width={{pieWidth||0}} height=36></rect></clippath><rect width=12 height=12 rx=6 ry=6 x=4 ng-attr-fill={{slice.color}}></rect><text x=18 y=11 font-size=11 text-anchor=start>{{slice.header}}</text></g></g></svg>'),a.put("components/image-upload/image-upload.html",'<div class=image-upload ng-style="{width: width, height: height}"><div ngf-drop ngf-select ng-model=file class=image-upload-dropbox accept="\'image/*\'" ngf-pattern="\'image/*\'" ng-style="{width: width, height: height}" ngf-resize="{width: width, height: height}"><img ngf-thumbnail="file || value"></div></div>'),a.put("components/layout/content-body.html",'<div class=layout-content-body ng-style="{bottom: footerHeight}"><div ng-transclude></div></div>'),a.put("components/layout/content-footer.html",'<div class=layout-content-footer ng-style="{height: footerHeight}"><div class=layout-content-splitter ng-mousedown=startDrag($event)></div><div class=layout-content-footer-content ng-transclude></div></div>'),a.put("components/layout/content-header.html","<div class=layout-content-header><div ng-transclude></div></div>"),a.put("components/layout/navbar.html",'<div class="navbar navbar-default navbar-static-top" ng-controller=NavbarCtrl><div class=container-fluid><div class=navbar-header><button class=navbar-toggle type=button ng-click="isCollapsed = !isCollapsed"><span class=sr-only>Toggle navigation</span> <span class=icon-bar></span> <span class=icon-bar></span> <span class=icon-bar></span></button> <a href=/main class=navbar-brand>Lysasoft</a></div><div uib-collapse=isCollapsed class="navbar-collapse collapse" id=navbar-main><ul class="nav navbar-nav"><li ng-repeat="item in menu" ng-if="!item.permission || config.user.permissions[item.permission]" ng-class="{active: isActive(item.link), dropdown: !!item.submenu}"><a href=# class=dropdown-toggle data-toggle=dropdown role=button aria-expanded=false ng-if=item.submenu><i class="fa {{item.icon}}" ng-if=item.icon></i> {{item.title}}<span class=caret></span></a><ul class=dropdown-menu role=menu ng-if=item.submenu><li ng-repeat="item in item.submenu" ng-if="!item.permission || config.user.permissions[item.permission]"><a ng-href={{item.link}}><i class="fa {{item.icon}}" ng-if=item.icon></i> {{item.title}}</a></li></ul><a ng-href={{item.link}} ng-if=!item.submenu><i class="fa {{item.icon}}" ng-if=item.icon></i> {{item.title}}</a></li></ul><ul class="nav navbar-nav navbar-right"><li class=navbar-logged><a type=button ng-click=doLogout() href=#><i class="fa fa-sign-out"></i> Déconnexion {{ config.user.user.login + ( config.user.user.server.identifier ? (\'@\' + config.user.user.server.identifier ) : \'\' ) }}</a></li></ul></div></div></div>'),a.put("components/layout/server-sidebar.html",'<div><div class=sidebar-server ng-class="!currentServerId ? \'selected\' : \'\'" ng-click=setServer(null)>{{ defaultText || \'Tous les serveurs\' }}</div><div ng-repeat="server in servers" class=sidebar-server ng-class="currentServerId === server.idServer ? \'selected\' : \'\'" ng-click=setServer(server)><img ng-src={{server.logoUrl()}} alt=""><div ng-if="server.idServer === config.server.idServer"><i class="fa fa-home"></i></div><div class=server-name>{{server.name}}</div></div></div>'),a.put("components/modal/modal.html",'<div class=modal-header><button ng-if=dismissable type=button ng-click=$dismiss() class=close>&times;</button><h3 ng-if=title ng-bind=title class=modal-title></h3></div><div class=modal-body><p ng-if=text ng-bind=text></p><div ng-if=html ng-bind-html=html></div></div><div class=modal-footer><button ng-repeat="button in buttons" ng-class=button.classes ng-click=button.click($event) ng-bind=button.text class=btn></button></div>'),a.put("components/period-picker/period-picker.html",'<div class="input-group period-picker"><input class=form-control uib-datepicker-popup="MMM yyyy" datepicker-append-to-body=true datepicker-options=datepickerOptions ng-model=date is-open=open close-text="Close"> <span class=input-group-btn><button type=button class="btn btn-default" ng-click="open = !open"><i class="glyphicon glyphicon-calendar"></i></button></span></div>'),a.put("components/select-users/select-users.html",'<ui-select multiple ng-model=$ctrl.ngModel theme=bootstrap reset-search-input=false title="Sélectionner des utilisateurs"><ui-select-match placeholder=Utilisateurs>{{$item.firstName}} {{$item.lastName}} <span>({{$item.login}})</span></ui-select-match><ui-select-choices repeat="user.uuid as user in $ctrl.users | filter: $ctrl.filter">{{user.firstName}} {{user.lastName}} <span>({{user.login}})</span></ui-select-choices></ui-select>')}]);